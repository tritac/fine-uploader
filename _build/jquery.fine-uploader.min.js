// Fine Uploader 5.16.2 - MIT licensed. http://fineuploader.com
!function(e){!function(e){"use strict";function n(e){var t=u(e||{}),n=i(t);return r(n),s(t,n),p}function i(e){var n=a("uploaderType"),i=a("endpointType");return n?(n=n.charAt(0).toUpperCase()+n.slice(1).toLowerCase(),i?new t[i]["FineUploader"+n](e):new t["FineUploader"+n](e)):i?new t[i].FineUploader(e):new t.FineUploader(e)}function o(e,t){var n=p.data("fineuploader");if(!t)return void 0===n?null:n[e];void 0===n&&(n={}),n[e]=t,p.data("fineuploader",n)}function r(e){return o("uploader",e)}function a(e,t){return o(e,t)}function s(n,i){var o=n.callbacks={};e.each(i._options.callbacks,function(n,i){var r,a;r=/^on(\w+)/.exec(n)[1],r=r.substring(0,1).toLowerCase()+r.substring(1),a=p,o[n]=function(){var n,o,s=Array.prototype.slice.call(arguments),u=[];e.each(s,function(e,t){u.push(d(t))}),n=i.apply(this,s);try{o=a.triggerHandler(r,u)}catch(e){t.log("Caught error in Fine Uploader jQuery event handler: "+e.message,"error")}return null!=n?n:o}}),i._options.callbacks=o}function u(t,n){var i,o;if(i=void 0===n?"basic"!==t.uploaderType?{element:p[0]}:{}:n,e.each(t,function(t,n){e.inArray(t,h)>=0?a(t,n):n instanceof e?i[t]=n[0]:e.isPlainObject(n)?(i[t]={},u(n,i[t])):e.isArray(n)?(o=[],e.each(n,function(t,n){var i={};n instanceof e?e.merge(o,n):e.isPlainObject(n)?(u(n,i),o.push(i)):o.push(n)}),i[t]=o):i[t]=n}),void 0===n)return i}function l(t){return"string"===e.type(t)&&!t.match(/^_/)&&void 0!==r()[t]}function c(e){var t,n=[],i=Array.prototype.slice.call(arguments,1);return u(i,n),t=r()[e].apply(r(),n),d(t)}function d(t){var n=t;return null==t||"object"!=typeof t||1!==t.nodeType&&9!==t.nodeType||!t.cloneNode||(n=e(t)),n}var p,h=["uploaderType","endpointType"];e.fn.fineUploader=function(t){var i=this,o=arguments,a=[];return this.each(function(s,u){if(p=e(u),r()&&l(t)){if(a.push(c.apply(i,o)),1===i.length)return!1}else"object"!=typeof t&&t?e.error("Method "+t+" does not exist on jQuery.fineUploader"):n.apply(i,o)}),1===a.length?a[0]:a.length>1?a:this}}(jQuery),function(e){"use strict";function n(e){e||(e={}),e.dropZoneElements=[l];var n=a(e);return r(n),o(new t.DragAndDrop(n)),l}function i(e,t){var n=l.data("fineUploaderDnd");if(!t)return void 0===n?null:n[e];void 0===n&&(n={}),n[e]=t,l.data("fineUploaderDnd",n)}function o(e){return i("dndInstance",e)}function r(n){var i=n.callbacks={};e.each(new t.DragAndDrop.callbacks,function(e,t){var n,o=e;n=l,i[e]=function(){var e=Array.prototype.slice.call(arguments);return n.triggerHandler(o,e)}})}function a(t,n){var i,o;if(i=void 0===n?{}:n,e.each(t,function(t,n){n instanceof e?i[t]=n[0]:e.isPlainObject(n)?(i[t]={},a(n,i[t])):e.isArray(n)?(o=[],e.each(n,function(t,n){n instanceof e?e.merge(o,n):o.push(n)}),i[t]=o):i[t]=n}),void 0===n)return i}function s(t){return"string"===e.type(t)&&"dispose"===t&&void 0!==o()[t]}function u(e){var t=[];return a(Array.prototype.slice.call(arguments,1),t),o()[e].apply(o(),t)}var l;e.fn.fineUploaderDnd=function(t){var i=this,r=arguments,a=[];return this.each(function(c,d){if(l=e(d),o()&&s(t)){if(a.push(u.apply(i,r)),1===i.length)return!1}else"object"!=typeof t&&t?e.error("Method "+t+" does not exist in Fine Uploader's DnD module."):n.apply(i,r)}),1===a.length?a[0]:a.length>1?a:this}}(jQuery);var t=function(e){"use strict";return{hide:function(){return e.style.display="none",this},attach:function(n,i){return e.addEventListener?e.addEventListener(n,i,!1):e.attachEvent&&e.attachEvent("on"+n,i),function(){t(e).detach(n,i)}},detach:function(t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.attachEvent&&e.detachEvent("on"+t,n),this},contains:function(t){return!!t&&(e===t||(e.contains?e.contains(t):!!(8&t.compareDocumentPosition(e))))},insertBefore:function(t){return t.parentNode.insertBefore(e,t),this},remove:function(){return e.parentNode.removeChild(e),this},css:function(n){if(null==e.style)throw new t.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");return null!=n.opacity&&"string"!=typeof e.style.opacity&&void 0!==e.filters&&(n.filter="alpha(opacity="+Math.round(100*n.opacity)+")"),t.extend(e.style,n),this},hasClass:function(t,n){var i=new RegExp("(^| )"+t+"( |$)");return i.test(e.className)||!(!n||!i.test(e.parentNode.className))},addClass:function(n){return t(e).hasClass(n)||(e.className+=" "+n),this},removeClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");return e.className=e.className.replace(n," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(n,i){var o,r=[];return i&&e.querySelector?e.querySelector("."+n):e.querySelectorAll?e.querySelectorAll("."+n):(o=e.getElementsByTagName("*"),t.each(o,function(e,i){t(i).hasClass(n)&&r.push(i)}),i?r[0]:r)},getFirstByClass:function(n){return t(e).getByClass(n,!0)},children:function(){for(var t=[],n=e.firstChild;n;)1===n.nodeType&&t.push(n),n=n.nextSibling;return t},setText:function(t){return e.innerText=t,e.textContent=t,this},clearText:function(){return t(e).setText("")},hasAttribute:function(t){var n;return e.hasAttribute?!!e.hasAttribute(t)&&null==/^false$/i.exec(e.getAttribute(t)):(n=e[t],void 0!==n&&null==/^false$/i.exec(n))}}};!function(){"use strict";t.canvasToBlob=function(e,n,i){return t.dataUriToBlob(e.toDataURL(n,i))},t.dataUriToBlob=function(e){var n,i,o,r,a=function(e,t){var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=n&&new n;return i?(i.append(e),i.getBlob(t)):new Blob([e],{type:t})};return i=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURI(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(i.length),o=new Uint8Array(n),t.each(i,function(e,t){o[e]=t.charCodeAt(0)}),a(n,r)},t.log=function(e,t){window.console&&(t&&"info"!==t?window.console[t]?window.console[t](e):window.console.log("<"+t+"> "+e):window.console.log(e))},t.isObject=function(e){return e&&!e.nodeType&&"[object Object]"===Object.prototype.toString.call(e)},t.isFunction=function(e){return"function"==typeof e},t.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)||e&&window.ArrayBuffer&&e.buffer&&e.buffer.constructor===ArrayBuffer},t.isItemList=function(e){return"[object DataTransferItemList]"===Object.prototype.toString.call(e)},t.isNodeList=function(e){return"[object NodeList]"===Object.prototype.toString.call(e)||e.item&&e.namedItem},t.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},t.trimStr=function(e){return String.prototype.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},t.format=function(e){var n=Array.prototype.slice.call(arguments,1),i=e,o=i.indexOf("{}");return t.each(n,function(e,t){if(i=i.substring(0,o)+t+i.substring(o+2),o=i.indexOf("{}",o+t.length),o<0)return!1}),i},t.isFile=function(e){return window.File&&"[object File]"===Object.prototype.toString.call(e)},t.isFileList=function(e){return window.FileList&&"[object FileList]"===Object.prototype.toString.call(e)},t.isFileOrInput=function(e){return t.isFile(e)||t.isInput(e)},t.isInput=function(e,t){var n=function(e){var n=e.toLowerCase();return t?"file"!==n:"file"===n};return!!(window.HTMLInputElement&&"[object HTMLInputElement]"===Object.prototype.toString.call(e)&&e.type&&n(e.type))||!!(e.tagName&&"input"===e.tagName.toLowerCase()&&e.type&&n(e.type))},t.isBlob=function(e){if(window.Blob&&"[object Blob]"===Object.prototype.toString.call(e))return!0},t.isXhrUploadSupported=function(){var e=document.createElement("input");return e.type="file",void 0!==e.multiple&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&void 0!==t.createXhrInstance().upload},t.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){return t.log("Neither XHR or ActiveX are supported!","error"),null}},t.isFolderDropSupported=function(e){return e.items&&e.items.length>0&&e.items[0].webkitGetAsEntry},t.isFileChunkingSupported=function(){return!t.androidStock()&&t.isXhrUploadSupported()&&(void 0!==File.prototype.slice||void 0!==File.prototype.webkitSlice||void 0!==File.prototype.mozSlice)},t.sliceBlob=function(e,t,n){return(e.slice||e.mozSlice||e.webkitSlice).call(e,t,n)},t.arrayBufferToHex=function(e){var n="",i=new Uint8Array(e);return t.each(i,function(e,t){var i=t.toString(16);i.length<2&&(i="0"+i),n+=i}),n},t.readBlobToHex=function(e,n,i){var o=t.sliceBlob(e,n,n+i),r=new FileReader,a=new t.Promise;return r.onload=function(){a.success(t.arrayBufferToHex(r.result))},r.onerror=a.failure,r.readAsArrayBuffer(o),a},t.extend=function(e,n,i){return t.each(n,function(n,o){i&&t.isObject(o)?(void 0===e[n]&&(e[n]={}),t.extend(e[n],o,!0)):e[n]=o}),e},t.override=function(e,n){var i={},o=n(i);return t.each(o,function(t,n){void 0!==e[t]&&(i[t]=e[t]),e[t]=n}),e},t.indexOf=function(e,t,n){if(e.indexOf)return e.indexOf(t,n);n=n||0;var i=e.length;for(n<0&&(n+=i);n<i;n+=1)if(e.hasOwnProperty(n)&&e[n]===t)return n;return-1},t.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},t.ie=function(){return navigator.userAgent.indexOf("MSIE")!==-1||navigator.userAgent.indexOf("Trident")!==-1},t.ie7=function(){return navigator.userAgent.indexOf("MSIE 7")!==-1},t.ie8=function(){return navigator.userAgent.indexOf("MSIE 8")!==-1},t.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!==-1},t.ie11=function(){return t.ie()&&navigator.userAgent.indexOf("rv:11")!==-1},t.edge=function(){return navigator.userAgent.indexOf("Edge")>=0},t.safari=function(){return void 0!==navigator.vendor&&navigator.vendor.indexOf("Apple")!==-1},t.chrome=function(){return void 0!==navigator.vendor&&navigator.vendor.indexOf("Google")!==-1},t.opera=function(){return void 0!==navigator.vendor&&navigator.vendor.indexOf("Opera")!==-1},t.firefox=function(){return!t.edge()&&!t.ie11()&&navigator.userAgent.indexOf("Mozilla")!==-1&&void 0!==navigator.vendor&&""===navigator.vendor},t.windows=function(){return"Win32"===navigator.platform},t.android=function(){return navigator.userAgent.toLowerCase().indexOf("android")!==-1},t.androidStock=function(){return t.android()&&navigator.userAgent.toLowerCase().indexOf("chrome")<0&&navigator.userAgent.toLowerCase().indexOf("firefox")<0},t.ios6=function(){return t.ios()&&navigator.userAgent.indexOf(" OS 6_")!==-1},t.ios7=function(){return t.ios()&&navigator.userAgent.indexOf(" OS 7_")!==-1},t.ios8=function(){return t.ios()&&navigator.userAgent.indexOf(" OS 8_")!==-1},t.ios800=function(){return t.ios()&&navigator.userAgent.indexOf(" OS 8_0 ")!==-1},t.ios=function(){return navigator.userAgent.indexOf("iPad")!==-1||navigator.userAgent.indexOf("iPod")!==-1||navigator.userAgent.indexOf("iPhone")!==-1},t.iosChrome=function(){return t.ios()&&navigator.userAgent.indexOf("CriOS")!==-1},t.iosSafari=function(){return t.ios()&&!t.iosChrome()&&navigator.userAgent.indexOf("Safari")!==-1},t.iosSafariWebView=function(){return t.ios()&&!t.iosChrome()&&!t.iosSafari()},t.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},t.toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var n=e.firstChild;return e.removeChild(n),n}}(),t.each=function(e,n){var i,o;if(e)if(window.Storage&&e.constructor===window.Storage)for(i=0;i<e.length&&(o=n(e.key(i),e.getItem(e.key(i))),o!==!1);i++);else if(t.isArray(e)||t.isItemList(e)||t.isNodeList(e))for(i=0;i<e.length&&(o=n(i,e[i]),o!==!1);i++);else if(t.isString(e))for(i=0;i<e.length&&(o=n(i,e.charAt(i)),o!==!1);i++);else for(i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&(o=n(i,e[i]),o===!1))break},t.bind=function(e,n){if(t.isFunction(e)){var i=Array.prototype.slice.call(arguments,2);return function(){var o=t.extend([],i);return arguments.length&&(o=o.concat(Array.prototype.slice.call(arguments))),e.apply(n,o)}}throw new Error("first parameter must be a function!")},t.obj2url=function(e,n,i){var o=[],r="&",a=function(e,i){var r=n?/\[\]$/.test(n)?n:n+"["+i+"]":i;"undefined"!==r&&"undefined"!==i&&o.push("object"==typeof e?t.obj2url(e,r,!0):"[object Function]"===Object.prototype.toString.call(e)?encodeURIComponent(r)+"="+encodeURIComponent(e()):encodeURIComponent(r)+"="+encodeURIComponent(e))};return!i&&n?(r=/\?/.test(n)?/\?$/.test(n)?"":"&":"?",o.push(n),o.push(t.obj2url(e))):"[object Array]"===Object.prototype.toString.call(e)&&void 0!==e?t.each(e,function(e,t){a(t,e)}):void 0!==e&&null!==e&&"object"==typeof e?t.each(e,function(e,t){a(t,e)}):o.push(encodeURIComponent(n)+"="+encodeURIComponent(e)),n?o.join(r):o.join(r).replace(/^&/,"").replace(/%20/g,"+")},t.obj2FormData=function(e,n,i){return n||(n=new FormData),t.each(e,function(e,o){e=i?i+"["+e+"]":e,t.isObject(o)?t.obj2FormData(o,n,e):t.isFunction(o)?n.append(e,o()):n.append(e,o)}),n},t.obj2Inputs=function(e,n){var i;return n||(n=document.createElement("form")),t.obj2FormData(e,{append:function(e,t){i=document.createElement("input"),i.setAttribute("name",e),i.setAttribute("value",t),n.appendChild(i)}}),n},t.parseJson=function(e){if(window.JSON&&t.isFunction(JSON.parse))return JSON.parse(e);throw new Error("JSON.parse is not supported in this environment, the code is only meant to run katanaPIM")},t.getExtension=function(e){var t=e.lastIndexOf(".")+1;if(t>0)return e.substr(t,e.length-t)},t.getFilename=function(e){return t.isInput(e)?e.value.replace(/.*(\/|\\)/,""):t.isFile(e)&&null!==e.fileName&&void 0!==e.fileName?e.fileName:e.name},t.DisposeSupport=function(){var e=[];return{dispose:function(){var t;do t=e.shift(),t&&t();while(t)},attach:function(){var e=arguments;this.addDisposer(t(e[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}}}(),function(){"use strict";"function"==typeof define&&define.amd?define(function(){return t}):"undefined"!=typeof module&&module.exports?module.exports=t:e.qq=t}(),function(){"use strict";t.Error=function(e){this.message="[Fine Uploader "+t.version+"] "+e},t.Error.prototype=new Error}(),t.version="5.16.2",t.supportedFeatures=function(){"use strict";function e(){var e,n=!0;try{e=document.createElement("input"),e.type="file",t(e).hide(),e.disabled&&(n=!1)}catch(e){n=!1}return n}function n(){return(t.chrome()||t.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)}function i(){if(window.XMLHttpRequest){return void 0!==t.createXhrInstance().withCredentials}return!1}function o(){return void 0!==window.XDomainRequest}function r(){return!!i()||o()}function a(){return void 0!==document.createElement("input").webkitdirectory}function s(){try{return!!window.localStorage&&t.isFunction(window.localStorage.setItem)}catch(e){return!1}}function u(){var e=document.createElement("span");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&!t.android()&&!t.ios()}var l,c,d,p,h,f,m,g,_,v,b,y,S,w,F;return l=e(),p=l&&t.isXhrUploadSupported(),c=p&&!t.androidStock(),d=p&&u(),h=d&&function(){var e=document.createElement("input");return e.type="file",!!("webkitdirectory"in(e||document.querySelectorAll("input[type=file]")[0]))}(),f=p&&t.isFileChunkingSupported(),m=p&&f&&s(),g=p&&n(),_=l&&(void 0!==window.postMessage||p),b=i(),v=o(),y=r(),S=a(),w=p&&void 0!==window.FileReader,F=function(){return!!p&&(!t.androidStock()&&!t.iosChrome())}(),{ajaxUploading:p,blobUploading:c,canDetermineSize:p,chunking:f,deleteFileCors:y,deleteFileCorsXdr:v,deleteFileCorsXhr:b,dialogElement:!!window.HTMLDialogElement,fileDrop:d,folderDrop:h,folderSelection:S,imagePreviews:w,imageValidation:w,itemSizeValidation:p,pause:f,progressBar:F,resume:m,scaling:w&&c,tiffPreviews:t.safari(),unlimitedScaledImageSize:!t.ios(),uploading:l,uploadCors:_,uploadCustomHeaders:p,uploadNonMultipart:p,uploadViaPaste:g}}(),t.isGenericPromise=function(e){"use strict";return!!(e&&e.then&&t.isFunction(e.then))},t.Promise=function(){"use strict";var e,n,i=[],o=[],r=[],a=0;t.extend(this,{then:function(t,r){return 0===a?(t&&i.push(t),r&&o.push(r)):a===-1?r&&r.apply(null,n):t&&t.apply(null,e),this},done:function(t){return 0===a?r.push(t):t.apply(null,void 0===n?e:n),this},success:function(){return a=1,e=arguments,i.length&&t.each(i,function(t,n){n.apply(null,e)}),r.length&&t.each(r,function(t,n){n.apply(null,e)}),this},failure:function(){return a=-1,n=arguments,o.length&&t.each(o,function(e,t){t.apply(null,n)}),r.length&&t.each(r,function(e,t){t.apply(null,n)}),this}})},t.BlobProxy=function(e,n){"use strict";t.extend(this,{referenceBlob:e,create:function(){return n(e)}})},t.UploadButton=function(e){"use strict";function n(){var e=document.createElement("input");return e.setAttribute(t.UploadButton.BUTTON_ID_ATTR_NAME,o),e.setAttribute("title",s.title),r.setMultiple(s.multiple,e),s.folders&&t.supportedFeatures.folderSelection&&e.setAttribute("webkitdirectory",""),s.acceptFiles&&e.setAttribute("accept",s.acceptFiles),e.setAttribute("type","file"),e.setAttribute("name",s.name),t(e).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:t.ie()&&!t.ie8()?"3500px":"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),!t.ie7()&&t(e).css({height:"100%"}),s.element.appendChild(e),a.attach(e,"change",function(){s.onChange(e)}),a.attach(e,"mouseover",function(){t(s.element).addClass(s.hoverClass)}),a.attach(e,"mouseout",function(){t(s.element).removeClass(s.hoverClass)}),a.attach(e,"focus",function(){t(s.element).addClass(s.focusClass)}),a.attach(e,"blur",function(){t(s.element).removeClass(s.focusClass)}),e}var i,o,r=this,a=new t.DisposeSupport,s={acceptFiles:null,element:null,focusClass:"qq-upload-button-focus",folders:!1,hoverClass:"qq-upload-button-hover",ios8BrowserCrashWorkaround:!1,multiple:!1,name:"qqfile",onChange:function(e){},title:null};t.extend(s,e),o=t.getUniqueId(),t(s.element).css({position:"relative",overflow:"hidden",direction:"ltr"}),t.extend(this,{getInput:function(){return i},getButtonId:function(){return o},setMultiple:function(e,n){var i=n||this.getInput();s.ios8BrowserCrashWorkaround&&t.ios8()&&(t.iosChrome()||t.iosSafariWebView())?i.setAttribute("multiple",""):e?i.setAttribute("multiple",""):i.removeAttribute("multiple")},setAcceptFiles:function(e){e!==s.acceptFiles&&i.setAttribute("accept",e)},reset:function(){i.parentNode&&t(i).remove(),t(s.element).removeClass(s.focusClass),i=null,i=n()}}),i=n()},t.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id",t.UploadData=function(e){"use strict";function n(e){if(t.isArray(e)){var n=[];return t.each(e,function(e,t){n.push(r[t])}),n}return r[e]}function i(e){if(t.isArray(e)){var n=[];return t.each(e,function(e,t){n.push(r[a[t]])}),n}return r[a[e]]}function o(e){var n=[],i=[].concat(e);return t.each(i,function(e,i){var o=s[i];void 0!==o&&t.each(o,function(e,t){n.push(r[t])})}),n}var r=[],a={},s={},u={},l={};t.extend(this,{addFile:function(n){var i=n.status||t.status.SUBMITTING,o=r.push({name:n.name,originalName:n.name,uuid:n.uuid,size:null==n.size?-1:n.size,status:i,file:n.file})-1;return n.batchId&&(r[o].batchId=n.batchId,void 0===l[n.batchId]&&(l[n.batchId]=[]),l[n.batchId].push(o)),n.proxyGroupId&&(r[o].proxyGroupId=n.proxyGroupId,void 0===u[n.proxyGroupId]&&(u[n.proxyGroupId]=[]),u[n.proxyGroupId].push(o)),r[o].id=o,a[n.uuid]=o,void 0===s[i]&&(s[i]=[]),s[i].push(o),n.onBeforeStatusChange&&n.onBeforeStatusChange(o),e.onStatusChange(o,null,i),o},retrieve:function(e){return t.isObject(e)&&r.length?void 0!==e.id?n(e.id):void 0!==e.uuid?i(e.uuid):e.status?o(e.status):void 0:t.extend([],r,!0)},removeFileRef:function(e){var t=n(e);t&&delete t.file},reset:function(){r=[],a={},s={},l={}},setStatus:function(n,i){var o=r[n].status,a=t.indexOf(s[o],n);s[o].splice(a,1),r[n].status=i,void 0===s[i]&&(s[i]=[]),s[i].push(n),e.onStatusChange(n,o,i)},uuidChanged:function(e,t){var n=r[e].uuid;r[e].uuid=t,a[t]=e,delete a[n]},updateName:function(e,t){r[e].name=t},updateSize:function(e,t){r[e].size=t},setParentId:function(e,t){r[e].parentId=t},getIdsInProxyGroup:function(e){var t=r[e].proxyGroupId;return t?u[t]:[]},getIdsInBatch:function(e){return l[r[e].batchId]}})},t.status={SUBMITTING:"submitting",SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_FINALIZING:"upload finalizing",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"},function(){"use strict";t.basePublicApi={addBlobs:function(e,t,n){this.addFiles(e,t,n)},addInitialFiles:function(e){var n=this;t.each(e,function(e,t){n._addCannedFile(t)})},addFiles:function(e,n,i){this._maybeHandleIos8SafariWorkaround();var o=0===this._storedIds.length?t.getUniqueId():this._currentBatchId,r=t.bind(function(e){this._handleNewFile({blob:e,name:this._options.blobs.defaultName},o,p)},this),a=t.bind(function(e){this._handleNewFile(e,o,p)},this),s=t.bind(function(e){var n=t.canvasToBlob(e);this._handleNewFile({blob:n,name:this._options.blobs.defaultName+".png"},o,p)},this),u=t.bind(function(e){var n=e.quality&&e.quality/100,i=t.canvasToBlob(e.canvas,e.type,n);this._handleNewFile({blob:i,name:e.name},o,p)},this),l=t.bind(function(e){if(t.isInput(e)&&t.supportedFeatures.ajaxUploading){var n=Array.prototype.slice.call(e.files),i=this;t.each(n,function(e,t){i._handleNewFile(t,o,p)})}else this._handleNewFile(e,o,p)},this),c=function(){t.isFileList(e)&&(e=Array.prototype.slice.call(e)),e=[].concat(e)},d=this,p=[];this._currentBatchId=o,e&&(c(),t.each(e,function(e,n){t.isFileOrInput(n)?l(n):t.isBlob(n)?r(n):t.isObject(n)?n.blob&&n.name?a(n):n.canvas&&n.name&&u(n):n.tagName&&"canvas"===n.tagName.toLowerCase()?s(n):d.log(n+" is not a valid file container!  Ignoring!","warn")}),this.log("Received "+p.length+" files."),this._prepareItemsForUpload(p,n,i))},cancel:function(e){var n=this._uploadData.retrieve({id:e});n&&n.status===t.status.UPLOAD_FINALIZING?this.log(t.format("Ignoring cancel for file ID {} ({}).  Finalizing upload.",e,this.getName(e)),"error"):this._handler.cancel(e)},cancelAll:function(){var e=[],n=this;t.extend(e,this._storedIds),t.each(e,function(e,t){n.cancel(t)}),this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(e){var n=this._uploadData.retrieve({id:e});return!(!t.supportedFeatures.pause||!this._options.chunking.enabled)&&(n.status===t.status.PAUSED?(this.log(t.format("Paused file ID {} ({}) will be continued.  Not paused.",e,this.getName(e))),this._uploadFile(e),!0):(this.log(t.format("Ignoring continue for file ID {} ({}).  Not paused.",e,this.getName(e)),"error"),!1))},deleteFile:function(e){return this._onSubmitDelete(e)},doesExist:function(e){return this._handler.isValid(e)},drawThumbnail:function(e,n,i,o,r){var a,s,u=new t.Promise;return this._imageGenerator?(a=this._thumbnailUrls[e],s={customResizeFunction:r,maxSize:i>0?i:null,scale:i>0},!o&&t.supportedFeatures.imagePreviews&&(a=this.getFile(e)),null==a?u.failure({container:n,error:"File or URL not found."}):this._imageGenerator.generate(a,n,s).then(function(e){u.success(e)},function(e,t){u.failure({container:e,error:t||"Problem generating thumbnail"})})):u.failure({container:n,error:"Missing image generator module"}),u},getButton:function(e){return this._getButton(this._buttonIdsForFileIds[e])},getEndpoint:function(e){return this._endpointStore.get(e)},getFile:function(e){var t,n=this._handler.getFile(e);return n||(t=this._uploadData.retrieve({id:e}),t&&(n=t.file)),n||null},getInProgress:function(){return this._uploadData.retrieve({status:[t.status.UPLOADING,t.status.UPLOAD_RETRYING,t.status.QUEUED]}).length},getName:function(e){return this._uploadData.retrieve({id:e}).name},getParentId:function(e){var t=this.getUploads({id:e}),n=null;return t&&void 0!==t.parentId&&(n=t.parentId),n},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(e){return this._uploadData.retrieve({id:e}).size},getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){var e=this._currentItemLimit;return e>0?e-this._netUploadedOrQueued:null},getUploads:function(e){return this._uploadData.retrieve(e)},getUuid:function(e){return this._uploadData.retrieve({id:e}).uuid},isResumable:function(e){return this._handler.hasResumeRecord(e)},log:function(e,n){!this._options.debug||n&&"info"!==n?n&&"info"!==n&&t.log("[Fine Uploader "+t.version+"] "+e,n):t.log("[Fine Uploader "+t.version+"] "+e)},pauseUpload:function(e){var n=this._uploadData.retrieve({id:e});if(!t.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(t.indexOf([t.status.UPLOADING,t.status.UPLOAD_RETRYING],n.status)>=0){if(this._handler.pause(e))return this._uploadData.setStatus(e,t.status.PAUSED),!0;this.log(t.format("Unable to pause file ID {} ({}).",e,this.getName(e)),"error")}else this.log(t.format("Ignoring pause for file ID {} ({}).  Not in progress.",e,this.getName(e)),"error");return!1},removeFileRef:function(e){this._handler.expunge(e),this._uploadData.removeFileRef(e)},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],t.each(this._buttons,function(e,t){t.reset()}),this._paramsStore.reset(),this._endpointStore.reset(),this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData.reset(),this._buttonIdsForFileIds=[],this._pasteHandler&&this._pasteHandler.reset(),this._options.session.refreshOnReset&&this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._totalProgress&&this._totalProgress.reset(),this._customResumeDataStore.reset()},retry:function(e){return this._manualRetry(e)},scaleImage:function(e,n){var i=this;return t.Scaler.prototype.scaleImage(e,n,{log:t.bind(i.log,i),getFile:t.bind(i.getFile,i),uploadData:i._uploadData})},setCustomHeaders:function(e,t){this._customHeadersStore.set(e,t)},setCustomResumeData:function(e,t){this._customResumeDataStore.set(t,e)},setDeleteFileCustomHeaders:function(e,t){this._deleteFileCustomHeadersStore.set(e,t)},setDeleteFileEndpoint:function(e,t){this._deleteFileEndpointStore.set(e,t)},setDeleteFileParams:function(e,t){this._deleteFileParamsStore.set(e,t)},setEndpoint:function(e,t){this._endpointStore.set(e,t)},setForm:function(e){this._updateFormSupportAndParams(e)},setItemLimit:function(e){this._currentItemLimit=e},setName:function(e,t){this._uploadData.updateName(e,t)},setParams:function(e,t){this._paramsStore.set(e,t)},setUuid:function(e,t){return this._uploadData.uuidChanged(e,t)},setStatus:function(e,n){if(!this.getUploads({id:e}))throw new t.Error(e+" is not a valid file ID.");switch(n){case t.status.DELETED:this._onDeleteComplete(e,null,!1);break;case t.status.DELETE_FAILED:this._onDeleteComplete(e,null,!0);break;default:var i="Method setStatus called on '"+name+"' not implemented yet for "+n;throw this.log(i),new t.Error(i)}},uploadStoredFiles:function(){0===this._storedIds.length?this._itemError("noFilesError"):this._uploadStoredFiles()}},t.basePrivateApi={_addCannedFile:function(e){var n=this;return this._uploadData.addFile({uuid:e.uuid,name:e.name,size:e.size,status:t.status.UPLOAD_SUCCESSFUL,onBeforeStatusChange:function(t){e.deleteFileEndpoint&&n.setDeleteFileEndpoint(e.deleteFileEndpoint,t),e.deleteFileParams&&n.setDeleteFileParams(e.deleteFileParams,t),e.thumbnailUrl&&(n._thumbnailUrls[t]=e.thumbnailUrl),n._netUploaded++,n._netUploadedOrQueued++}})},_annotateWithButtonId:function(e,n){t.isFile(e)&&(e.qqButtonId=this._getButtonId(n))},_batchError:function(e){this._options.callbacks.onError(null,null,e,void 0)},_createDeleteHandler:function(){var e=this;return new t.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,cors:this._options.cors,log:t.bind(e.log,e),onDelete:function(t){e._onDelete(t),e._options.callbacks.onDelete(t)},onDeleteComplete:function(t,n,i){e._onDeleteComplete(t,n,i),e._options.callbacks.onDeleteComplete(t,n,i)}})},_createPasteHandler:function(){var e=this;return new t.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:t.bind(e.log,e),pasteReceived:function(n){e._handleCheckedCallback({name:"onPasteReceived",callback:t.bind(e._options.callbacks.onPasteReceived,e,n),onSuccess:t.bind(e._handlePasteSuccess,e,n),identifier:"pasted image"})}}})},_createStore:function(e,n){var i={},o=e,r={},a=n,s=function(e){return t.isObject(e)?t.extend({},e):e},u=function(){return t.isFunction(a)?a():a},l=function(e,n){a&&t.isObject(n)&&t.extend(n,u()),r[e]&&t.extend(n,r[e])};return{set:function(e,t){null==t?(i={},o=s(e)):i[t]=s(e)},get:function(e){var t;return t=null!=e&&i[e]?i[e]:s(o),l(e,t),s(t)},addReadOnly:function(e,n){t.isObject(i)&&(null===e?t.isFunction(n)?a=n:(a=a||{},t.extend(a,n)):(r[e]=r[e]||{},t.extend(r[e],n)))},remove:function(e){return delete i[e]},reset:function(){i={},r={},o=e}}},_createUploadDataTracker:function(){var e=this;return new t.UploadData({getName:function(t){return e.getName(t)},getUuid:function(t){return e.getUuid(t)},getSize:function(t){return e.getSize(t)},onStatusChange:function(t,n,i){e._onUploadStatusChange(t,n,i),e._options.callbacks.onStatusChange(t,n,i),e._maybeAllComplete(t,i),e._totalProgress&&setTimeout(function(){e._totalProgress.onStatusChange(t,n,i)},0)}})},_createUploadButton:function(e){function n(){return!!t.supportedFeatures.ajaxUploading&&(!(o._options.workarounds.iosEmptyVideos&&t.ios()&&!t.ios6()&&o._isAllowedExtension(a,".mov"))&&(void 0===e.multiple?o._options.multiple:e.multiple))}var i,o=this,r=e.accept||this._options.validation.acceptFiles,a=e.allowedExtensions||this._options.validation.allowedExtensions;return i=new t.UploadButton({acceptFiles:r,element:e.element,focusClass:this._options.classes.buttonFocus,folders:e.folders,hoverClass:this._options.classes.buttonHover,ios8BrowserCrashWorkaround:this._options.workarounds.ios8BrowserCrash,multiple:n(),name:this._options.request.inputName,onChange:function(e){o._onInputChange(e)},title:null==e.title?this._options.text.fileInputTitle:e.title}),this._disposeSupport.addDisposer(function(){i.dispose()}),o._buttons.push(i),i},_createUploadHandler:function(e,n){var i=this,o={},r={debug:this._options.debug,maxConnections:this._options.maxConnections,cors:this._options.cors,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:t.bind(i.log,i),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(e,t,n,r){n<0||r<0||(o[e]?o[e].loaded===n&&o[e].total===r||(i._onProgress(e,t,n,r),i._options.callbacks.onProgress(e,t,n,r)):(i._onProgress(e,t,n,r),i._options.callbacks.onProgress(e,t,n,r)),o[e]={loaded:n,total:r})},onComplete:function(e,n,r,a){delete o[e];var s,u=i.getUploads({id:e}).status;u!==t.status.UPLOAD_SUCCESSFUL&&u!==t.status.UPLOAD_FAILED&&(s=i._onComplete(e,n,r,a),s instanceof t.Promise?s.done(function(){i._options.callbacks.onComplete(e,n,r,a)}):i._options.callbacks.onComplete(e,n,r,a))},onCancel:function(e,n,o){var r=new t.Promise;return i._handleCheckedCallback({name:"onCancel",callback:t.bind(i._options.callbacks.onCancel,i,e,n),onFailure:r.failure,onSuccess:function(){o.then(function(){i._onCancel(e,n)}),r.success()},identifier:e}),r},onUploadPrep:t.bind(this._onUploadPrep,this),onUpload:function(e,n){i._onUpload(e,n);var o=i._options.callbacks.onUpload(e,n);return t.isGenericPromise(o)?(i.log(t.format("onUpload for {} returned a Promise - waiting for resolution.",e)),o):(new t.Promise).success()},onUploadChunk:function(e,n,o){i._onUploadChunk(e,o);var r=i._options.callbacks.onUploadChunk(e,n,o);return t.isGenericPromise(r)?(i.log(t.format("onUploadChunk for {}.{} returned a Promise - waiting for resolution.",e,o.partIndex)),r):(new t.Promise).success()},
onUploadChunkSuccess:function(e,t,n,o){i._onUploadChunkSuccess(e,t),i._options.callbacks.onUploadChunkSuccess.apply(i,arguments)},onResume:function(e,t,n,o){return i._options.callbacks.onResume(e,t,n,o)},onAutoRetry:function(e,t,n,o){return i._onAutoRetry.apply(i,arguments)},onUuidChanged:function(e,t){i.log("Server requested UUID change from '"+i.getUuid(e)+"' to '"+t+"'"),i.setUuid(e,t)},getName:t.bind(i.getName,i),getUuid:t.bind(i.getUuid,i),getSize:t.bind(i.getSize,i),setSize:t.bind(i._setSize,i),getDataByUuid:function(e){return i.getUploads({uuid:e})},isQueued:function(e){var n=i.getUploads({id:e}).status;return n===t.status.QUEUED||n===t.status.SUBMITTED||n===t.status.UPLOAD_RETRYING||n===t.status.PAUSED},getIdsInProxyGroup:i._uploadData.getIdsInProxyGroup,getIdsInBatch:i._uploadData.getIdsInBatch,isInProgress:function(e){return i.getUploads({id:e}).status===t.status.UPLOADING},getCustomResumeData:t.bind(i._getCustomResumeData,i),setStatus:function(e,t){i._uploadData.setStatus(e,t)}};return t.each(this._options.request,function(e,t){r[e]=t}),r.customHeaders=this._customHeadersStore,e&&t.each(e,function(e,t){r[e]=t}),new t.UploadHandlerController(r,n)},_fileOrBlobRejected:function(e){this._netUploadedOrQueued--,this._uploadData.setStatus(e,t.status.REJECTED)},_formatSize:function(e){if(0===e)return e+this._options.text.sizeSymbols[0];var t=-1;do e/=1e3,t++;while(e>999);return Math.max(e,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_generateExtraButtonSpecs:function(){var e=this;this._extraButtonSpecs={},t.each(this._options.extraButtons,function(n,i){var o=i.multiple,r=t.extend({},e._options.validation,!0),a=t.extend({},i);void 0===o&&(o=e._options.multiple),a.validation&&t.extend(r,i.validation,!0),t.extend(a,{multiple:o,validation:r},!0),e._initExtraButton(a)})},_getButton:function(e){var t=this._extraButtonSpecs[e];return t?t.element:e===this._defaultButtonId?this._options.button:void 0},_getButtonId:function(e){var n,i,o=e;if(o instanceof t.BlobProxy&&(o=o.referenceBlob),o&&!t.isBlob(o)){if(t.isFile(o))return o.qqButtonId;if("input"===o.tagName.toLowerCase()&&"file"===o.type.toLowerCase())return o.getAttribute(t.UploadButton.BUTTON_ID_ATTR_NAME);if(n=o.getElementsByTagName("input"),t.each(n,function(e,t){if("file"===t.getAttribute("type"))return i=t,!1}),i)return i.getAttribute(t.UploadButton.BUTTON_ID_ATTR_NAME)}},_getCustomResumeData:function(e){return this._customResumeDataStore.get(e)},_getNotFinished:function(){return this._uploadData.retrieve({status:[t.status.UPLOADING,t.status.UPLOAD_RETRYING,t.status.QUEUED,t.status.SUBMITTING,t.status.SUBMITTED,t.status.PAUSED]}).length},_getValidationBase:function(e){var t=this._extraButtonSpecs[e];return t?t.validation:this._options.validation},_getValidationDescriptor:function(e){return e.file instanceof t.BlobProxy?{name:t.getFilename(e.file.referenceBlob),size:e.file.referenceBlob.size}:{name:this.getUploads({id:e.id}).name,size:this.getUploads({id:e.id}).size}},_getValidationDescriptors:function(e){var n=this,i=[];return t.each(e,function(e,t){i.push(n._getValidationDescriptor(t))}),i},_handleCameraAccess:function(){if(this._options.camera.ios&&t.ios()){var e=this._options.camera.button,n=e?this._getButtonId(e):this._defaultButtonId,i=this._options;n&&n!==this._defaultButtonId&&(i=this._extraButtonSpecs[n]),i.multiple=!1,null===i.validation.acceptFiles?i.validation.acceptFiles="image/*;capture=camera":i.validation.acceptFiles+=",image/*;capture=camera",t.each(this._buttons,function(e,t){if(t.getButtonId()===n)return t.setMultiple(i.multiple),t.setAcceptFiles(i.acceptFiles),!1})}},_handleCheckedCallback:function(e){var n=this,i=e.callback();return t.isGenericPromise(i)?(this.log(e.name+" - waiting for "+e.name+" promise to be fulfilled for "+e.identifier),i.then(function(t){n.log(e.name+" promise success for "+e.identifier),e.onSuccess(t)},function(){e.onFailure?(n.log(e.name+" promise failure for "+e.identifier),e.onFailure()):n.log(e.name+" promise failure for "+e.identifier)})):(i!==!1?e.onSuccess(i):e.onFailure?(this.log(e.name+" - return value was 'false' for "+e.identifier+".  Invoking failure callback."),e.onFailure()):this.log(e.name+" - return value was 'false' for "+e.identifier+".  Will not proceed."),i)},_handleNewFile:function(e,n,i){var o=this,r=t.getUniqueId(),a=-1,s=t.getFilename(e),u=e.blob||e,l=this._customNewFileHandler?this._customNewFileHandler:t.bind(o._handleNewFileGeneric,o);!t.isInput(u)&&u.size>=0&&(a=u.size),l(u,s,r,a,i,n,this._options.request.uuidName,{uploadData:o._uploadData,paramsStore:o._paramsStore,addFileToHandler:function(e,t){o._handler.add(e,t),o._netUploadedOrQueued++,o._trackButton(e)}})},_handleNewFileGeneric:function(e,t,n,i,o,r){var a=this._uploadData.addFile({uuid:n,name:t,size:i,batchId:r,file:e});this._handler.add(a,e),this._trackButton(a),this._netUploadedOrQueued++,o.push({id:a,file:e})},_handlePasteSuccess:function(e,t){var n=e.type.split("/")[1],i=t;null==i&&(i=this._options.paste.defaultName),i+="."+n,this.addFiles({name:i,blob:e})},_handleDeleteSuccess:function(e){if(this.getUploads({id:e}).status!==t.status.DELETED){var n=this.getName(e);this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(e),this._uploadData.setStatus(e,t.status.DELETED),this.log("Delete request for '"+n+"' has succeeded.")}},_handleDeleteFailed:function(e,n){var i=this.getName(e);this._uploadData.setStatus(e,t.status.DELETE_FAILED),this.log("Delete request for '"+i+"' has failed.","error"),n&&void 0!==n.withCredentials?this._options.callbacks.onError(e,i,"Delete request failed with response code "+n.status,n):this._options.callbacks.onError(e,i,"Delete request failed",n)},_initExtraButton:function(e){var t=this._createUploadButton({accept:e.validation.acceptFiles,allowedExtensions:e.validation.allowedExtensions,element:e.element,folders:e.folders,multiple:e.multiple,title:e.fileInputTitle});this._extraButtonSpecs[t.getButtonId()]=e},_initFormSupportAndParams:function(){this._formSupport=t.FormSupport&&new t.FormSupport(this._options.form,t.bind(this.uploadStoredFiles,this),t.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm?(this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&(this._options.request.endpoint=this._formSupport.newEndpoint)):this._paramsStore=this._createStore(this._options.request.params)},_isDeletePossible:function(){return!(!t.DeleteFileAjaxRequester||!this._options.deleteFile.enabled)&&(!this._options.cors.expected||(!!t.supportedFeatures.deleteFileCorsXhr||!(!t.supportedFeatures.deleteFileCorsXdr||!this._options.cors.allowXdr)))},_isAllowedExtension:function(e,n){var i=!1;return!e.length||(t.each(e,function(e,o){if(t.isString(o)){var r=new RegExp("\\."+o+"$","i");if(null!=n.match(r))return i=!0,!1}}),i)},_itemError:function(e,n,i){function o(e,t){s=s.replace(e,t)}var r,a,s=this._options.messages[e],u=[],l=[].concat(n),c=l[0],d=this._getButtonId(i),p=this._getValidationBase(d);return t.each(p.allowedExtensions,function(e,n){t.isString(n)&&u.push(n)}),r=u.join(", ").toLowerCase(),o("{file}",this._options.formatFileName(c)),o("{extensions}",r),o("{sizeLimit}",this._formatSize(p.sizeLimit)),o("{minSizeLimit}",this._formatSize(p.minSizeLimit)),a=s.match(/(\{\w+\})/g),null!==a&&t.each(a,function(e,t){o(t,l[e])}),this._options.callbacks.onError(null,c,s,void 0),s},_manualRetry:function(e,n){if(this._onBeforeManualRetry(e))return this._netUploadedOrQueued++,this._uploadData.setStatus(e,t.status.UPLOAD_RETRYING),n?n(e):this._handler.retry(e),!0},_maybeAllComplete:function(e,n){var i=this,o=this._getNotFinished();n===t.status.UPLOAD_SUCCESSFUL?this._succeededSinceLastAllComplete.push(e):n===t.status.UPLOAD_FAILED&&this._failedSinceLastAllComplete.push(e),0===o&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)&&setTimeout(function(){i._onAllComplete(i._succeededSinceLastAllComplete,i._failedSinceLastAllComplete)},0)},_maybeHandleIos8SafariWorkaround:function(){var e=this;if(this._options.workarounds.ios8SafariUploads&&t.ios800()&&t.iosSafari())throw setTimeout(function(){window.alert(e._options.messages.unsupportedBrowserIos8Safari)},0),new t.Error(this._options.messages.unsupportedBrowserIos8Safari)},_maybeParseAndSendUploadError:function(e,t,n,i){if(!n.success)if(i&&200!==i.status&&!n.error)this._options.callbacks.onError(e,t,"XHR returned response code "+i.status,i);else{var o=n.error?n.error:this._options.text.defaultResponseError;this._options.callbacks.onError(e,t,o,i)}},_maybeProcessNextItemAfterOnValidateCallback:function(e,n,i,o,r){var a=this;if(n.length>i)if(e||!this._options.validation.stopOnFirstInvalidFile)setTimeout(function(){var e=a._getValidationDescriptor(n[i]),s=a._getButtonId(n[i].file),u=a._getButton(s);a._handleCheckedCallback({name:"onValidate",callback:t.bind(a._options.callbacks.onValidate,a,e,u),onSuccess:t.bind(a._onValidateCallbackSuccess,a,n,i,o,r),onFailure:t.bind(a._onValidateCallbackFailure,a,n,i,o,r),identifier:"Item '"+e.name+"', size: "+e.size})},0);else if(!e)for(;i<n.length;i++)a._fileOrBlobRejected(n[i].id)},_onAllComplete:function(e,n){this._totalProgress&&this._totalProgress.onAllComplete(e,n,this._preventRetries),this._options.callbacks.onAllComplete(t.extend([],e),t.extend([],n)),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[]},_onAutoRetry:function(e,n,i,o,r){var a=this;if(a._preventRetries[e]=i[a._options.retry.preventRetryResponseProperty],a._shouldAutoRetry(e)){var s=1e3*a._options.retry.autoAttemptDelay;return a._maybeParseAndSendUploadError.apply(a,arguments),a._options.callbacks.onAutoRetry(e,n,a._autoRetries[e]),a._onBeforeAutoRetry(e,n),a._uploadData.setStatus(e,t.status.UPLOAD_RETRYING),a._retryTimeouts[e]=setTimeout(function(){a.log("Starting retry for "+n+"..."),r?r(e):a._handler.retry(e)},s),!0}},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onBeforeManualRetry:function(e){var t,n=this._currentItemLimit;return this._preventRetries[e]?(this.log("Retries are forbidden for id "+e,"warn"),!1):this._handler.isValid(e)?(t=this.getName(e),this._options.callbacks.onManualRetry(e,t)!==!1&&(n>0&&this._netUploadedOrQueued+1>n?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+t+"' (id: "+e+")..."),!0))):(this.log("'"+e+"' is not a valid file ID","error"),!1)},_onCancel:function(e,n){this._netUploadedOrQueued--,clearTimeout(this._retryTimeouts[e]);var i=t.indexOf(this._storedIds,e);!this._options.autoUpload&&i>=0&&this._storedIds.splice(i,1),this._uploadData.setStatus(e,t.status.CANCELED)},_onComplete:function(e,n,i,o){return i.success?(i.thumbnailUrl&&(this._thumbnailUrls[e]=i.thumbnailUrl),this._netUploaded++,this._uploadData.setStatus(e,t.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(e,t.status.UPLOAD_FAILED),i[this._options.retry.preventRetryResponseProperty]===!0&&(this._preventRetries[e]=!0)),this._maybeParseAndSendUploadError(e,n,i,o),!!i.success},_onDelete:function(e){this._uploadData.setStatus(e,t.status.DELETING)},_onDeleteComplete:function(e,t,n){this.getName(e);n?this._handleDeleteFailed(e,t):this._handleDeleteSuccess(e)},_onInputChange:function(e){var n;if(t.supportedFeatures.ajaxUploading){for(n=0;n<e.files.length;n++)this._annotateWithButtonId(e.files[n],e);this.addFiles(e.files)}else e.value.length>0&&this.addFiles(e);t.each(this._buttons,function(e,t){t.reset()})},_onProgress:function(e,t,n,i){this._totalProgress&&this._totalProgress.onIndividualProgress(e,n,i)},_onSubmit:function(e,t){},_onSubmitCallbackSuccess:function(e,n){this._onSubmit.apply(this,arguments),this._uploadData.setStatus(e,t.status.SUBMITTED),this._onSubmitted.apply(this,arguments),this._options.autoUpload?(this._options.callbacks.onSubmitted.apply(this,arguments),this._uploadFile(e)):(this._storeForLater(e),this._options.callbacks.onSubmitted.apply(this,arguments))},_onSubmitDelete:function(e,n,i){var o,r=this.getUuid(e);return n&&(o=t.bind(n,this,e,r,i)),this._isDeletePossible()?(this._handleCheckedCallback({name:"onSubmitDelete",callback:t.bind(this._options.callbacks.onSubmitDelete,this,e),onSuccess:o||t.bind(this._deleteHandler.sendDelete,this,e,r,i),identifier:e}),!0):(this.log("Delete request ignored for ID "+e+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onSubmitted:function(e){},_onTotalProgress:function(e,t){this._options.callbacks.onTotalProgress(e,t)},_onUploadPrep:function(e){},_onUpload:function(e,n){this._uploadData.setStatus(e,t.status.UPLOADING)},_onUploadChunk:function(e,t){},_onUploadChunkSuccess:function(e,t){!this._preventRetries[e]&&this._options.retry.enableAuto&&(this._autoRetries[e]=0)},_onUploadStatusChange:function(e,n,i){i===t.status.PAUSED&&clearTimeout(this._retryTimeouts[e])},_onValidateBatchCallbackFailure:function(e){var n=this;t.each(e,function(e,t){n._fileOrBlobRejected(t.id)})},_onValidateBatchCallbackSuccess:function(e,n,i,o,r){var a,s=this._currentItemLimit,u=this._netUploadedOrQueued;0===s||u<=s?n.length>0?this._handleCheckedCallback({name:"onValidate",callback:t.bind(this._options.callbacks.onValidate,this,e[0],r),onSuccess:t.bind(this._onValidateCallbackSuccess,this,n,0,i,o),onFailure:t.bind(this._onValidateCallbackFailure,this,n,0,i,o),identifier:"Item '"+n[0].file.name+"', size: "+n[0].file.size}):this._itemError("noFilesError"):(this._onValidateBatchCallbackFailure(n),a=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,u).replace(/\{itemLimit\}/g,s),this._batchError(a))},_onValidateCallbackFailure:function(e,t,n,i){var o=t+1;this._fileOrBlobRejected(e[t].id,e[t].file.name),this._maybeProcessNextItemAfterOnValidateCallback(!1,e,o,n,i)},_onValidateCallbackSuccess:function(e,t,n,i){var o=this,r=t+1,a=this._getValidationDescriptor(e[t]);this._validateFileOrBlobData(e[t],a).then(function(){o._upload(e[t].id,n,i),o._maybeProcessNextItemAfterOnValidateCallback(!0,e,r,n,i)},function(){o._maybeProcessNextItemAfterOnValidateCallback(!1,e,r,n,i)})},_prepareItemsForUpload:function(e,n,i){if(0===e.length)return void this._itemError("noFilesError");var o=this._getValidationDescriptors(e),r=this._getButtonId(e[0].file),a=this._getButton(r);this._handleCheckedCallback({name:"onValidateBatch",callback:t.bind(this._options.callbacks.onValidateBatch,this,o,a),onSuccess:t.bind(this._onValidateBatchCallbackSuccess,this,o,e,n,i,a),onFailure:t.bind(this._onValidateBatchCallbackFailure,this,e),identifier:"batch validation"})},_preventLeaveInProgress:function(){var e=this;this._disposeSupport.attach(window,"beforeunload",function(t){if(e.getInProgress())return t=t||window.event,t.returnValue=e._options.messages.onLeave,e._options.messages.onLeave})},_refreshSessionData:function(){var e=this,n=this._options.session;t.Session&&null!=this._options.session.endpoint&&(this._session||(t.extend(n,{cors:this._options.cors}),n.log=t.bind(this.log,this),n.addFileRecord=t.bind(this._addCannedFile,this),this._session=new t.Session(n)),setTimeout(function(){e._session.refresh().then(function(t,n){e._sessionRequestComplete(),e._options.callbacks.onSessionRequestComplete(t,!0,n)},function(t,n){e._options.callbacks.onSessionRequestComplete(t,!1,n)})},0))},_sessionRequestComplete:function(){},_setSize:function(e,t){this._uploadData.updateSize(e,t),this._totalProgress&&this._totalProgress.onNewSize(e)},_shouldAutoRetry:function(e){var n=this._uploadData.retrieve({id:e});return!!(!this._preventRetries[e]&&this._options.retry.enableAuto&&n.status!==t.status.PAUSED&&(void 0===this._autoRetries[e]&&(this._autoRetries[e]=0),this._autoRetries[e]<this._options.retry.maxAutoAttempts))&&(this._autoRetries[e]+=1,!0)},_storeForLater:function(e){this._storedIds.push(e)},_trackButton:function(e){var n;n=t.supportedFeatures.ajaxUploading?this._handler.getFile(e).qqButtonId:this._getButtonId(this._handler.getInput(e)),n&&(this._buttonIdsForFileIds[e]=n)},_updateFormSupportAndParams:function(e){this._options.form.element=e,this._formSupport=t.FormSupport&&new t.FormSupport(this._options.form,t.bind(this.uploadStoredFiles,this),t.bind(this.log,this)),this._formSupport&&this._formSupport.attachedToForm&&(this._paramsStore.addReadOnly(null,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&this.setEndpoint(this._formSupport.newEndpoint))},_upload:function(e,n,i){var o=this.getName(e);n&&this.setParams(n,e),i&&this.setEndpoint(i,e),this._handleCheckedCallback({name:"onSubmit",callback:t.bind(this._options.callbacks.onSubmit,this,e,o),onSuccess:t.bind(this._onSubmitCallbackSuccess,this,e,o),onFailure:t.bind(this._fileOrBlobRejected,this,e,o),identifier:e})},_uploadFile:function(e){this._handler.upload(e)||this._uploadData.setStatus(e,t.status.QUEUED)},_uploadStoredFiles:function(){for(var e,n,i=this;this._storedIds.length;)e=this._storedIds.shift(),this._uploadFile(e);n=this.getUploads({status:t.status.SUBMITTING}).length,n&&(t.log("Still waiting for "+n+" files to clear submit queue. Will re-parse stored IDs array shortly."),setTimeout(function(){i._uploadStoredFiles()},1e3))},_validateFileOrBlobData:function(e,n){var i=this,o=function(){return e.file instanceof t.BlobProxy?e.file.referenceBlob:e.file}(),r=n.name,a=n.size,s=this._getButtonId(e.file),u=this._getValidationBase(s),l=new t.Promise;return l.then(function(){},function(){i._fileOrBlobRejected(e.id,r)}),t.isFileOrInput(o)&&!this._isAllowedExtension(u.allowedExtensions,r)?(this._itemError("typeError",r,o),l.failure()):this._options.validation.allowEmpty||0!==a?a>0&&u.sizeLimit&&a>u.sizeLimit?(this._itemError("sizeError",r,o),l.failure()):a>0&&a<u.minSizeLimit?(this._itemError("minSizeError",r,o),l.failure()):(t.ImageValidation&&t.supportedFeatures.imagePreviews&&t.isFile(o)?new t.ImageValidation(o,t.bind(i.log,i)).validate(u.image).then(l.success,function(e){i._itemError(e+"ImageError",r,o),l.failure()}):l.success(),l):(this._itemError("emptyError",r,o),l.failure())},_wrapCallbacks:function(){var e,t,n;e=this,t=function(t,n,i){var o;try{return n.apply(e,i)}catch(n){o=n.message||n.toString(),e.log("Caught exception in '"+t+"' callback - "+o,"error")}};for(n in this._options.callbacks)!function(){var i,o;i=n,o=e._options.callbacks[i],e._options.callbacks[i]=function(){return t(i,o,arguments)}}()}}}(),function(){"use strict";t.FineUploaderBasic=function(e){var n=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,warnBeforeUnload:!0,request:{customHeaders:{},endpoint:"/server/upload",filenameParam:"qqfilename",forceMultipart:!0,inputName:"qqfile",method:"POST",omitDefaultParams:!1,params:{},paramsInBody:!0,requireSuccessJson:!0,totalFileSizeName:"qqtotalfilesize",uuidName:"qquuid"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null,image:{maxHeight:0,maxWidth:0,minHeight:0,minWidth:0},allowEmpty:!1},callbacks:{onSubmit:function(e,t){},onSubmitted:function(e,t){},onComplete:function(e,t,n,i){},onAllComplete:function(e,t){},onCancel:function(e,t){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onUploadChunkSuccess:function(e,t,n,i){},onResume:function(e,t,n,i){},onProgress:function(e,t,n,i){},onTotalProgress:function(e,t){},onError:function(e,t,n,i){},onAutoRetry:function(e,t,n){},onManualRetry:function(e,t){},onValidateBatch:function(e){},onValidate:function(e){},onSubmitDelete:function(e){},onDelete:function(e){},onDeleteComplete:function(e,t,n){},onPasteReceived:function(e){},onStatusChange:function(e,t,n){},onSessionRequestComplete:function(e,t,n){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled.",unsupportedBrowserIos8Safari:"Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,concurrent:{enabled:!1},mandatory:!1,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:function(e){return 2e6},success:{endpoint:null,headers:function(e){return null},jsonPayload:!1,method:"POST",params:function(e){return null},resetOnStatus:[]}},resume:{enabled:!1,recordsExpireIn:7,paramNames:{resuming:"qqresume"},customKeys:function(e){return[]}},formatFileName:function(e){return e},text:{defaultResponseError:"Upload failure reason unknown",fileInputTitle:"file input",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:!0},form:{element:"qq-form",autoUpload:!1,interceptSubmit:!0},scaling:{customResizer:null,sendOriginal:!0,orient:!0,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:!1,sizes:[]},workarounds:{iosEmptyVideos:!0,ios8SafariUploads:!0,ios8BrowserCrash:!1}},t.extend(this._options,e,!0),this._buttons=[],this._extraButtonSpecs={},this._buttonIdsForFileIds=[],this._wrapCallbacks(),this._disposeSupport=new t.DisposeSupport,this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._thumbnailUrls=[],this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData=this._createUploadDataTracker(),this._initFormSupportAndParams(),this._customHeadersStore=this._createStore(this._options.request.customHeaders),this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders),this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params),this._endpointStore=this._createStore(this._options.request.endpoint),this._deleteFileEndpointStore=this._createStore(this._options.deleteFile.endpoint),this._handler=this._createUploadHandler(),this._deleteHandler=t.DeleteFileAjaxRequester&&this._createDeleteHandler(),this._options.button&&(this._defaultButtonId=this._createUploadButton({element:this._options.button,title:this._options.text.fileInputTitle}).getButtonId()),this._generateExtraButtonSpecs(),this._handleCameraAccess(),this._options.paste.targetElement&&(t.PasteSupport?this._pasteHandler=this._createPasteHandler():this.log("Paste support module not found","error")),this._options.warnBeforeUnload&&this._preventLeaveInProgress(),this._imageGenerator=t.ImageGenerator&&new t.ImageGenerator(t.bind(this.log,this)),this._refreshSessionData(),this._succeededSinceLastAllComplete=[],this._failedSinceLastAllComplete=[],this._scaler=t.Scaler&&new t.Scaler(this._options.scaling,t.bind(this.log,this))||{},this._scaler.enabled&&(this._customNewFileHandler=t.bind(this._scaler.handleNewFile,this._scaler)),t.TotalProgress&&t.supportedFeatures.progressBar&&(this._totalProgress=new t.TotalProgress(t.bind(this._onTotalProgress,this),function(e){var t=n._uploadData.retrieve({id:e});return t&&t.size||0})),this._currentItemLimit=this._options.validation.itemLimit,this._customResumeDataStore=this._createStore()},t.FineUploaderBasic.prototype=t.basePublicApi,t.extend(t.FineUploaderBasic.prototype,t.basePrivateApi)}(),t.AjaxRequester=function(e){"use strict";function n(){return t.indexOf(["GET","POST","HEAD"],F.method)>=0}function i(e){var n=!1;return t.each(n,function(e,i){if(t.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],i)<0)return n=!0,!1}),n}function o(e){return F.cors.expected&&void 0===e.withCredentials}function r(){var e;return(window.XMLHttpRequest||window.ActiveXObject)&&(e=t.createXhrInstance(),void 0===e.withCredentials&&(e=new XDomainRequest,e.onload=function(){},e.onerror=function(){},e.ontimeout=function(){},e.onprogress=function(){})),e}function a(e,n){var i=w[e]&&w[e].xhr;return i||(i=n?n:F.cors.expected?r():t.createXhrInstance(),w[e].xhr=i),i}function s(e){var n,i=t.indexOf(S,e),o=F.maxConnections;delete w[e],S.splice(i,1),S.length>=o&&i<o&&(n=S[o-1],c(n))}function u(e,t){var n=a(e),i=F.method,r=t===!0;s(e),r?b(i+" request for "+e+" has failed","error"):o(n)||_(n.status)||(r=!0,b(i+" request for "+e+" has failed - response code "+n.status,"error")),F.onComplete(e,n,r)}function l(e){var n,i=w[e].additionalParams,o=F.mandatedParams;return F.paramsStore.get&&(n=F.paramsStore.get(e)),i&&t.each(i,function(e,t){n=n||{},n[e]=t}),o&&t.each(o,function(e,t){n=n||{},n[e]=t}),n}function c(e,n){var i,r=a(e,n),s=F.method,u=l(e),c=w[e].payload;return F.onSend(e),i=d(e,u,w[e].additionalQueryParams),o(r)?(r.onload=f(e),r.onerror=m(e)):r.onreadystatechange=p(e),h(e),r.open(s,i,!0),F.cors.expected&&F.cors.sendCredentials&&!o(r)&&(r.withCredentials=!0),g(e),b("Sending "+s+" request for "+e),c?r.send(c):y||!u?r.send():u&&F.contentType&&F.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")>=0?r.send(t.obj2url(u,"")):u&&F.contentType&&F.contentType.toLowerCase().indexOf("application/json")>=0?r.send(JSON.stringify(u)):r.send(u),r}function d(e,n,i){var o=F.endpointStore.get(e),r=w[e].addToPath;return void 0!=r&&(o+="/"+r),y&&n&&(o=t.obj2url(n,o)),i&&(o=t.obj2url(i,o)),o}function p(e){return function(){4===a(e).readyState&&u(e)}}function h(e){var t=F.onProgress;t&&(a(e).upload.onprogress=function(n){n.lengthComputable&&t(e,n.loaded,n.total)})}function f(e){return function(){u(e)}}function m(e){return function(){u(e,!0)}}function g(e){var r=a(e),s=F.customHeaders,u=w[e].additionalHeaders||{},l=F.method,c={};o(r)||(F.acceptHeader&&r.setRequestHeader("Accept",F.acceptHeader),F.allowXRequestedWithAndCacheControl&&(F.cors.expected&&n()&&!i(s)||(r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Cache-Control","no-cache"))),!F.contentType||"POST"!==l&&"PUT"!==l||r.setRequestHeader("Content-Type",F.contentType),t.extend(c,t.isFunction(s)?s(e):s),t.extend(c,u),t.each(c,function(e,t){r.setRequestHeader(e,t)}))}function _(e){return t.indexOf(F.successfulResponseCodes[F.method],e)>=0}function v(e,t,n,i,o,r,a){if(w[e]={addToPath:n,additionalParams:i,additionalQueryParams:o,additionalHeaders:r,payload:a},S.push(e)<=F.maxConnections)return c(e,t)}var b,y,S=[],w={},F={acceptHeader:null,validMethods:["PATCH","POST","PUT"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:!0,successfulResponseCodes:{DELETE:[200,202,204],PATCH:[200,201,202,203,204],POST:[200,201,202,203,204],PUT:[200,201,202,203,204],GET:[200]},cors:{expected:!1,sendCredentials:!1},log:function(e,t){},onSend:function(e){},onComplete:function(e,t,n){},onProgress:null};if(t.extend(F,e),b=F.log,t.indexOf(F.validMethods,F.method)<0)throw new Error("'"+F.method+"' is not a supported method for this type of request!");y="GET"===F.method||"DELETE"===F.method,t.extend(this,{initTransport:function(e){var n,i,o,r,a,s;return{withPath:function(e){return n=e,this},withParams:function(e){return i=e,this},withQueryParams:function(e){return s=e,this},withHeaders:function(e){return o=e,this},withPayload:function(e){return r=e,this},withCacheBuster:function(){return a=!0,this},send:function(u){return a&&t.indexOf(["GET","DELETE"],F.method)>=0&&(i.qqtimestamp=(new Date).getTime()),v(e,u,n,i,s,o,r)}}},canceled:function(e){s(e)}})},t.UploadHandler=function(e){"use strict";var n=e.proxy,i={},o=n.onCancel,r=n.getName;t.extend(this,{add:function(e,t){i[e]=t,i[e].temp={}},cancel:function(e){var n=this,a=new t.Promise;o(e,r(e),a).then(function(){n.isValid(e)&&(i[e].canceled=!0,n.expunge(e)),a.success()})},expunge:function(e){delete i[e]},getThirdPartyFileId:function(e){return i[e].key},isValid:function(e){return void 0!==i[e]},reset:function(){i={}},_getFileState:function(e){return i[e]},_setThirdPartyFileId:function(e,t){i[e].key=t},_wasCanceled:function(e){return!!i[e].canceled}})},t.UploadHandlerController=function(e,n){"use strict";var i,o,r,a=this,s=!1,u=!1,l={paramsStore:{},maxConnections:3,chunking:{enabled:!1,multiple:{enabled:!1}},log:function(e,t){},onProgress:function(e,t,n,i){},onComplete:function(e,t,n,i){},onCancel:function(e,t){},onUploadPrep:function(e){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onUploadChunkSuccess:function(e,t,n,i){},onAutoRetry:function(e,t,n,i){},onResume:function(e,t,n,i){},onUuidChanged:function(e,t){},getName:function(e){},setSize:function(e,t){},isQueued:function(e){},getIdsInProxyGroup:function(e){},getIdsInBatch:function(e){},isInProgress:function(e){}},c={done:function(e,t,n,i){var o=r._getChunkData(e,t);r._getFileState(e).attemptingResume=!1,delete r._getFileState(e).temp.chunkProgress[t],r._getFileState(e).loaded+=o.size,l.onUploadChunkSuccess(e,r._getChunkDataForCallback(o),n,i)},finalize:function(e){var t=l.getSize(e),n=l.getName(e);o("All chunks have been uploaded for "+e+" - finalizing...."),r.finalizeChunks(e).then(function(i,a){o("Finalize successful for "+e);var s=h.normalizeResponse(i,!0);l.onProgress(e,n,t,t),r._maybeDeletePersistedChunkData(e),h.cleanup(e,s,a)},function(t,i){var r=h.normalizeResponse(t,!1);o("Problem finalizing chunks for file ID "+e+" - "+r.error,"error"),(r.reset||i&&l.chunking.success.resetOnStatus.indexOf(i.status)>=0)&&c.reset(e),l.onAutoRetry(e,n,r,i)||h.cleanup(e,r,i)})},handleFailure:function(e,n,i,a){var s=l.getName(n);o("Chunked upload request failed for "+n+", chunk "+e),r.clearCachedChunk(n,e);var p,f=h.normalizeResponse(i,!1);if(f.reset)c.reset(n);else{var m=r._getFileState(n).chunking.inProgress;p=m?t.indexOf(m,e):-1,p>=0&&(r._getFileState(n).chunking.inProgress.splice(p,1),r._getFileState(n).chunking.remaining.unshift(e))}r._getFileState(n).temp.ignoreFailure||(u&&(r._getFileState(n).temp.ignoreFailure=!0,o(t.format("Going to attempt to abort these chunks: {}. These are currently in-progress: {}.",JSON.stringify(Object.keys(r._getXhrs(n))),JSON.stringify(r._getFileState(n).chunking.inProgress))),t.each(r._getXhrs(n),function(e,i){o(t.format("Attempting to abort file {}.{}. XHR readyState {}. ",n,e,i.readyState)),i.abort(),i._cancelled=!0}),r.moveInProgressToRemaining(n),d.free(n,!0)),l.onAutoRetry(n,s,f,a)||h.cleanup(n,f,a))},hasMoreParts:function(e){return!!r._getFileState(e).chunking.remaining.length},nextPart:function(e){var t=r._getFileState(e).chunking.remaining.shift();return t>=r._getTotalChunks(e)&&(t=null),t},reset:function(e){o("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+e,"error"),r._maybeDeletePersistedChunkData(e),r.reevaluateChunking(e),r._getFileState(e).loaded=0,r._getFileState(e).attemptingResume=!1},sendNext:function(e){
var n=l.getSize(e),i=l.getName(e),a=c.nextPart(e),s=r._getChunkData(e,a),p=r._getFileState(e),f=p.attemptingResume,m=p.chunking.inProgress||[];if(null==p.loaded&&(p.loaded=0),f&&l.onResume(e,i,s,p.customResumeData)===!1&&(c.reset(e),a=c.nextPart(e),s=r._getChunkData(e,a),f=!1),null==a&&0===m.length)c.finalize(e);else{m.push(a),r._getFileState(e).chunking.inProgress=m,u&&d.open(e,a),u&&d.available()&&r._getFileState(e).chunking.remaining.length&&c.sendNext(e),0===s.blob.size&&(o(t.format("Chunk {} for file {} will not be uploaded, zero sized chunk.",a,e),"error"),c.handleFailure(a,e,"File is no longer available",null));l.onUploadChunk(e,i,r._getChunkDataForCallback(s)).then(function(i){if(l.isInProgress(e)){o(t.format("Sending chunked upload request for item {}.{}, bytes {}-{} of {}.",e,a,s.start+1,s.end,n));var u={chunkIdx:a,id:e,overrides:i,resuming:f};r.uploadChunk(u).then(function(n,i){o("Chunked upload request succeeded for "+e+", chunk "+a),r.clearCachedChunk(e,a);var s=r._getFileState(e).chunking.inProgress||[],u=h.normalizeResponse(n,!0),l=t.indexOf(s,a);o(t.format("Chunk {} for file {} uploaded successfully.",a,e)),c.done(e,a,u,i),l>=0&&s.splice(l,1),r._maybePersistChunkedState(e),c.hasMoreParts(e)||0!==s.length?c.hasMoreParts(e)?c.sendNext(e):o(t.format("File ID {} has no more chunks to send and these chunk indexes are still marked as in-progress: {}",e,JSON.stringify(s))):c.finalize(e)},function(t,n){c.handleFailure(a,e,t,n)}).done(function(){r.clearXhr(e,a)})}else o(t.format("Not sending chunked upload request for item {}.{} - no longer in progress.",e,a))},function(t){c.handleFailure(a,e,t,null)})}}},d={_open:[],_openChunks:{},_waiting:[],available:function(){var e=l.maxConnections,n=0,i=0;return t.each(d._openChunks,function(e,t){n++,i+=t.length}),e-(d._open.length-n+i)},free:function(e,n){var i,a=!n,s=t.indexOf(d._waiting,e),u=t.indexOf(d._open,e);delete d._openChunks[e],h.getProxyOrBlob(e)instanceof t.BlobProxy&&(o("Generated blob upload has ended for "+e+", disposing generated blob."),delete r._getFileState(e).file),s>=0?d._waiting.splice(s,1):a&&u>=0&&(d._open.splice(u,1),i=d._waiting.shift(),i>=0&&(d._open.push(i),h.start(i)))},getWaitingOrConnected:function(){var e=[];return t.each(d._openChunks,function(t,n){n&&n.length&&e.push(parseInt(t))}),t.each(d._open,function(t,n){d._openChunks[n]||e.push(parseInt(n))}),e=e.concat(d._waiting)},isUsingConnection:function(e){return t.indexOf(d._open,e)>=0},open:function(e,t){return null==t&&d._waiting.push(e),!!d.available()&&(null==t?(d._waiting.pop(),d._open.push(e)):function(){var n=d._openChunks[e]||[];n.push(t),d._openChunks[e]=n}(),!0)},reset:function(){d._waiting=[],d._open=[]}},p={send:function(e,t){var n=r._getFileState(e);if(!n)return void o("Ignoring send request as this upload may have been cancelled, File ID "+e,"warn");n.loaded=0,o("Sending simple upload request for "+e),r.uploadFile(e).then(function(n,i){o("Simple upload request succeeded for "+e);var r=h.normalizeResponse(n,!0),a=l.getSize(e);l.onProgress(e,t,a,a),h.maybeNewUuid(e,r),h.cleanup(e,r,i)},function(n,i){o("Simple upload request failed for "+e);var r=h.normalizeResponse(n,!1);l.onAutoRetry(e,t,r,i)||h.cleanup(e,r,i)})}},h={cancel:function(e){o("Cancelling "+e),l.paramsStore.remove(e),d.free(e)},cleanup:function(e,t,n){var i=l.getName(e);l.onComplete(e,i,t,n),r._getFileState(e)&&r._clearXhrs&&r._clearXhrs(e),d.free(e)},getProxyOrBlob:function(e){return r.getProxy&&r.getProxy(e)||r.getFile&&r.getFile(e)},initHandler:function(){r=new(n?t[n]:t.traditional)[(t.supportedFeatures.ajaxUploading?"Xhr":"Form")+"UploadHandler"](l,{getCustomResumeData:l.getCustomResumeData,getDataByUuid:l.getDataByUuid,getName:l.getName,getSize:l.getSize,getUuid:l.getUuid,log:o,onCancel:l.onCancel,onProgress:l.onProgress,onUuidChanged:l.onUuidChanged,onFinalizing:function(e){l.setStatus(e,t.status.UPLOAD_FINALIZING)}}),r._removeExpiredChunkingRecords&&r._removeExpiredChunkingRecords()},isDeferredEligibleForUpload:function(e){return l.isQueued(e)},maybeDefer:function(e,n){return n&&!r.getFile(e)&&n instanceof t.BlobProxy?(l.onUploadPrep(e),o("Attempting to generate a blob on-demand for "+e),n.create().then(function(t){o("Generated an on-demand blob for "+e),r.updateBlob(e,t),l.setSize(e,t.size),r.reevaluateChunking(e),h.maybeSendDeferredFiles(e)},function(n){var r={};n&&(r.error=n),o(t.format("Failed to generate blob for ID {}.  Error message: {}.",e,n),"error"),l.onComplete(e,l.getName(e),t.extend(r,i),null),h.maybeSendDeferredFiles(e),d.free(e)}),!1):h.maybeSendDeferredFiles(e)},maybeSendDeferredFiles:function(e){var n=l.getIdsInProxyGroup(e),i=!1;return n&&n.length?(o("Maybe ready to upload proxy group file "+e),t.each(n,function(t,n){if(h.isDeferredEligibleForUpload(n)&&r.getFile(n))i=n===e,h.now(n);else if(h.isDeferredEligibleForUpload(n))return!1})):(i=!0,h.now(e)),i},maybeNewUuid:function(e,t){void 0!==t.newUuid&&l.onUuidChanged(e,t.newUuid)},normalizeResponse:function(e,n){var i=e;return t.isObject(e)||(i={},t.isString(e)&&!n&&(i.error=e)),i.success=n,i},now:function(e){var n=l.getName(e);if(!a.isValid(e))throw new t.Error(e+" is not a valid file ID to upload!");l.onUpload(e,n).then(function(i){i&&i.pause?(l.setStatus(e,t.status.PAUSED),r.pause(e),d.free(e)):s&&r._shouldChunkThisFile(e)?c.sendNext(e):p.send(e,n)},function(t){if(t=t||{},o(e+" upload start aborted due to rejected onUpload Promise - details: "+t,"error"),!l.onAutoRetry(e,n,t.responseJSON||{})){var i=h.normalizeResponse(t.responseJSON,!1);h.cleanup(e,i)}})},start:function(e){var t=h.getProxyOrBlob(e);return t?h.maybeDefer(e,t):(h.now(e),!0)}};t.extend(this,{add:function(e,t){r.add.apply(this,arguments)},upload:function(e){return!!d.open(e)&&h.start(e)},retry:function(e){return u&&(r._getFileState(e).temp.ignoreFailure=!1),d.isUsingConnection(e)?h.start(e):a.upload(e)},cancel:function(e){var n=r.cancel(e);t.isGenericPromise(n)?n.then(function(){h.cancel(e)}):n!==!1&&h.cancel(e)},cancelAll:function(){var e,t=d.getWaitingOrConnected();if(t.length)for(e=t.length-1;e>=0;e--)a.cancel(t[e]);d.reset()},getFile:function(e){return r.getProxy&&r.getProxy(e)?r.getProxy(e).referenceBlob:r.getFile&&r.getFile(e)},isProxied:function(e){return!(!r.getProxy||!r.getProxy(e))},getInput:function(e){if(r.getInput)return r.getInput(e)},reset:function(){o("Resetting upload handler"),a.cancelAll(),d.reset(),r.reset()},expunge:function(e){if(a.isValid(e))return r.expunge(e)},isValid:function(e){return r.isValid(e)},hasResumeRecord:function(e){var t=r.isValid(e)&&r._getLocalStorageId&&r._getLocalStorageId(e);return!!t&&!!localStorage.getItem(t)},getResumableFilesData:function(){return r.getResumableFilesData?r.getResumableFilesData():[]},getThirdPartyFileId:function(e){if(a.isValid(e))return r.getThirdPartyFileId(e)},pause:function(e){return!!(a.isResumable(e)&&r.pause&&a.isValid(e)&&r.pause(e))&&(d.free(e),r.moveInProgressToRemaining(e),!0)},isAttemptingResume:function(e){return!!r.isAttemptingResume&&r.isAttemptingResume(e)},isResumable:function(e){return!!r.isResumable&&r.isResumable(e)}}),t.extend(l,e),o=l.log,s=l.chunking.enabled&&t.supportedFeatures.chunking,u=s&&l.chunking.concurrent.enabled,i=function(){var e={};return e[l.preventRetryParam]=!0,e}(),h.initHandler()},t.WindowReceiveMessage=function(e){"use strict";var n={log:function(e,t){}},i={};t.extend(n,e),t.extend(this,{receiveMessage:function(e,n){var o=function(e){n(e.data)};window.postMessage?i[e]=t(window).attach("message",o):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(e){if(window.postMessage){var t=i[e];t&&t()}}})},t.FormUploadHandler=function(e){"use strict";function n(e){delete d[e],h&&(clearTimeout(p[e]),delete p[e],_.stopReceivingMessages(e));var n=document.getElementById(s._getIframeName(e));n&&(n.setAttribute("src","javascript:false;"),t(n).remove())}function i(e){return e.split("_")[0]}function o(e){var n=t.toElement("<iframe src='javascript:false;' name='"+e+"' />");return n.setAttribute("id",e),n.style.display="none",document.body.appendChild(n),n}function r(e,n){var o=e.id,r=i(o);c[m(r)]=n,d[r]=t(e).attach("load",function(){s.getInput(r)&&(g("Received iframe load event for CORS upload request (iframe name "+o+")"),p[o]=setTimeout(function(){var e="No valid message received from loaded iframe for iframe name "+o;g(e,"error"),n({error:e})},1e3))}),_.receiveMessage(o,function(e){g("Received the following window message: '"+e+"'");var t,n=(i(o),s._parseJsonResponse(e)),r=n.uuid;r&&c[r]?(g("Handling response for iframe name "+o),clearTimeout(p[o]),delete p[o],s._detachLoadEvent(o),t=c[r],delete c[r],_.stopReceivingMessages(o),t(n)):r||g("'"+e+"' does not contain a UUID - ignoring.")})}var a=e.options,s=this,u=e.proxy,l=t.getUniqueId(),c={},d={},p={},h=a.isCors,f=a.inputName,m=u.getUuid,g=u.log,_=new t.WindowReceiveMessage({log:g});t.extend(this,new t.UploadHandler(e)),t.override(this,function(e){return{add:function(n,i){e.add(n,{input:i}),i.setAttribute("name",f),i.parentNode&&t(i).remove()},expunge:function(t){n(t),e.expunge(t)},isValid:function(t){return e.isValid(t)&&void 0!==s._getFileState(t).input}}}),t.extend(this,{getInput:function(e){return s._getFileState(e).input},_attachLoadEvent:function(e,n){var i;h?r(e,n):d[e.id]=t(e).attach("load",function(){if(g("Received response for "+e.id),e.parentNode){try{if(e.contentDocument&&e.contentDocument.body&&"false"==e.contentDocument.body.innerHTML)return}catch(e){g("Error when attempting to access iframe during handling of upload response ("+e.message+")","error"),i={success:!1}}n(i)}})},_createIframe:function(e){return o(s._getIframeName(e))},_detachLoadEvent:function(e){void 0!==d[e]&&(d[e](),delete d[e])},_getIframeName:function(e){return e+"_"+l},_initFormForUpload:function(e){var n=e.method,i=e.endpoint,o=e.params,r=e.paramsInBody,a=e.targetName,s=t.toElement("<form method='"+n+"' enctype='multipart/form-data'></form>"),u=i;return r?t.obj2Inputs(o,s):u=t.obj2url(o,i),s.setAttribute("action",u),s.setAttribute("target",a),s.style.display="none",document.body.appendChild(s),s},_parseJsonResponse:function(e){var n={};try{n=t.parseJson(e)}catch(e){g("Error when attempting to parse iframe upload response ("+e.message+")","error")}return n}})},t.XhrUploadHandler=function(e){"use strict";function n(e){t.each(i._getXhrs(e),function(t,n){var o=i._getAjaxRequester(e,t);n.onreadystatechange=null,n.upload.onprogress=null,n.abort(),o&&o.canceled&&o.canceled(e)})}var i=this,o=e.options.namespace,r=e.proxy,a=e.options.chunking,s=function(e){var n=i._getFileState(e);if(n.chunkSize)return n.chunkSize;var o=a.partSize;return t.isFunction(o)&&(o=o(e,p(e))),n.chunkSize=o,o},u=e.options.resume,l=a&&e.options.chunking.enabled&&t.supportedFeatures.chunking,c=u&&e.options.resume.enabled&&l&&t.supportedFeatures.resume,d=r.getName,p=r.getSize,h=r.getUuid,f=r.getEndpoint,m=r.getDataByUuid,g=r.onUuidChanged,_=r.onProgress,v=r.log,b=r.getCustomResumeData;t.extend(this,new t.UploadHandler(e)),t.override(this,function(e){return{add:function(n,o){if(t.isFile(o)||t.isBlob(o))e.add(n,{file:o});else{if(!(o instanceof t.BlobProxy))throw new Error("Passed obj is not a File, Blob, or proxy");e.add(n,{proxy:o})}i._initTempState(n),c&&i._maybePrepareForResume(n)},expunge:function(t){n(t),i._maybeDeletePersistedChunkData(t),i._clearXhrs(t),e.expunge(t)}}}),t.extend(this,{clearCachedChunk:function(e,t){var n=i._getFileState(e);n&&delete n.temp.cachedChunks[t]},clearXhr:function(e,t){var n=i._getFileState(e).temp;n.xhrs&&delete n.xhrs[t],n.ajaxRequesters&&delete n.ajaxRequesters[t]},finalizeChunks:function(e,n){var o=i._getTotalChunks(e)-1,r=i._getXhr(e,o);return n?(new t.Promise).success(n(r),r):(new t.Promise).success({},r)},getFile:function(e){return i.isValid(e)&&i._getFileState(e).file},getProxy:function(e){return i.isValid(e)&&i._getFileState(e).proxy},getResumableFilesData:function(){var e=[];return i._iterateResumeRecords(function(t,n){i.moveInProgressToRemaining(null,n.chunking.inProgress,n.chunking.remaining);var o={name:n.name,remaining:n.chunking.remaining,size:n.size,uuid:n.uuid};n.key&&(o.key=n.key),n.customResumeData&&(o.customResumeData=n.customResumeData),e.push(o)}),e},isAttemptingResume:function(e){return i._getFileState(e).attemptingResume},isResumable:function(e){return!!a&&i.isValid(e)&&!i._getFileState(e).notResumable},moveInProgressToRemaining:function(e,n,o){var r=i._getFileState(e)||{},a=r.chunking||{},s=n||a.inProgress,u=o||a.remaining;s&&(v(t.format("Moving these chunks from in-progress {}, to remaining.",JSON.stringify(s))),s.reverse(),t.each(s,function(e,t){u.unshift(t)}),s.length=0)},pause:function(e){if(i.isValid(e))return v(t.format("Aborting XHR upload for {} '{}' due to pause instruction.",e,d(e))),i._getFileState(e).paused=!0,n(e),!0},reevaluateChunking:function(e){if(a&&i.isValid(e)){var t,n,o=i._getFileState(e);if(delete o.chunking,o.chunking={},t=i._getTotalChunks(e),t>1||a.mandatory){for(o.chunking.enabled=!0,o.chunking.parts=t,o.chunking.remaining=[],n=0;n<t;n++)o.chunking.remaining.push(n);i._initTempState(e)}else o.chunking.enabled=!1}},updateBlob:function(e,t){i.isValid(e)&&(i._getFileState(e).file=t)},_clearXhrs:function(e){var n=i._getFileState(e).temp;t.each(n.ajaxRequesters,function(e){delete n.ajaxRequesters[e]}),t.each(n.xhrs,function(e){delete n.xhrs[e]})},_createXhr:function(e,n){return i._registerXhr(e,n,t.createXhrInstance())},_getAjaxRequester:function(e,t){var n=null==t?-1:t;return i._getFileState(e).temp.ajaxRequesters[n]},_getChunkData:function(e,n){var o=s(e),r=p(e),a=i.getFile(e),u=o*n,l=u+o>=r?r:u+o,c=i._getTotalChunks(e),d=this._getFileState(e).temp.cachedChunks,h=d[n]||t.sliceBlob(a,u,l);return d[n]=h,{part:n,start:u,end:l,count:c,blob:h,size:l-u}},_getChunkDataForCallback:function(e){return{partIndex:e.part,startByte:e.start+1,endByte:e.end,totalParts:e.count}},_getLocalStorageId:function(e){var n=d(e),i=p(e),r=s(e),a=f(e),l=u.customKeys(e),c=t.format("qq{}resume{}-{}-{}-{}-{}",o,"5.0",n,i,r,a);return l.forEach(function(e){c+="-"+e}),c},_getMimeType:function(e){return i.getFile(e).type},_getPersistableData:function(e){return i._getFileState(e).chunking},_getTotalChunks:function(e){if(a){var t=p(e),n=s(e);return Math.ceil(t/n)}},_getXhr:function(e,t){var n=null==t?-1:t;return i._getFileState(e).temp.xhrs[n]},_getXhrs:function(e){return i._getFileState(e).temp.xhrs},_iterateResumeRecords:function(e){c&&t.each(localStorage,function(n,i){if(0===n.indexOf(t.format("qq{}resume",o))){e(n,JSON.parse(i))}})},_initTempState:function(e){i._getFileState(e).temp={ajaxRequesters:{},chunkProgress:{},xhrs:{},cachedChunks:{}}},_markNotResumable:function(e){i._getFileState(e).notResumable=!0},_maybeDeletePersistedChunkData:function(e){var t;return!!(c&&i.isResumable(e)&&(t=i._getLocalStorageId(e),t&&localStorage.getItem(t)))&&(localStorage.removeItem(t),!0)},_maybePrepareForResume:function(e){var n,o,r=i._getFileState(e);c&&void 0===r.key&&(n=i._getLocalStorageId(e),o=localStorage.getItem(n),o&&(o=JSON.parse(o),m(o.uuid)?i._markNotResumable(e):(v(t.format("Identified file with ID {} and name of {} as resumable.",e,d(e))),g(e,o.uuid),r.key=o.key,r.chunking=o.chunking,r.loaded=o.loaded,r.customResumeData=o.customResumeData,r.attemptingResume=!0,i.moveInProgressToRemaining(e))))},_maybePersistChunkedState:function(e){var n,o,r=i._getFileState(e);if(c&&i.isResumable(e)){var a=b(e);n=i._getLocalStorageId(e),o={name:d(e),size:p(e),uuid:h(e),key:r.key,chunking:r.chunking,loaded:r.loaded,lastUpdated:Date.now()},a&&(o.customResumeData=a);try{localStorage.setItem(n,JSON.stringify(o))}catch(n){v(t.format("Unable to save resume data for '{}' due to error: '{}'.",e,n.toString()),"warn")}}},_registerProgressHandler:function(e,n,o){var r=i._getXhr(e,n),a=d(e),s={simple:function(t,n){var i=p(e);t===n?_(e,a,i,i):_(e,a,t>=i?i-1:t,i)},chunked:function(r,s){var u=i._getFileState(e).temp.chunkProgress,l=i._getFileState(e).loaded,c=r,d=s,h=p(e),f=c-(d-o),m=l;u[n]=f,t.each(u,function(e,t){m+=t}),_(e,a,m,h)}};r.upload.onprogress=function(e){if(e.lengthComputable){s[null==o?"simple":"chunked"](e.loaded,e.total)}}},_registerXhr:function(e,t,n,o){var r=null==t?-1:t,a=i._getFileState(e).temp;return a.xhrs=a.xhrs||{},a.ajaxRequesters=a.ajaxRequesters||{},a.xhrs[r]=n,o&&(a.ajaxRequesters[r]=o),n},_removeExpiredChunkingRecords:function(){var e=u.recordsExpireIn;i._iterateResumeRecords(function(t,n){var i=new Date(n.lastUpdated);i.setDate(i.getDate()+e),i.getTime()<=Date.now()&&(v("Removing expired resume record with key "+t),localStorage.removeItem(t))})},_shouldChunkThisFile:function(e){var t=i._getFileState(e);if(t)return t.chunking||i.reevaluateChunking(e),t.chunking.enabled}})},t.DeleteFileAjaxRequester=function(e){"use strict";function n(){return"POST"===o.method.toUpperCase()?{_method:"DELETE"}:{}}var i,o={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:function(e){return{}},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(e,t){},onDelete:function(e){},onDeleteComplete:function(e,t,n){}};t.extend(o,e),i=t.extend(this,new t.AjaxRequester({acceptHeader:"application/json",validMethods:["POST","DELETE"],method:o.method,endpointStore:o.endpointStore,paramsStore:o.paramsStore,mandatedParams:n(),maxConnections:o.maxConnections,customHeaders:function(e){return o.customHeaders.get(e)},log:o.log,onSend:o.onDelete,onComplete:o.onDeleteComplete,cors:o.cors})),t.extend(this,{sendDelete:function(e,t,n){var r=n||{};o.log("Submitting delete file request for "+e),"DELETE"===o.method?i.initTransport(e).withPath(t).withParams(r).send():(r[o.uuidParamName]=t,i.initTransport(e).withParams(r).send())}})},function(){function e(e){var t,n=e.naturalWidth,i=e.naturalHeight,o=document.createElement("canvas");return n*i>1048576&&(o.width=o.height=1,t=o.getContext("2d"),t.drawImage(e,-n+1,0),0===t.getImageData(0,0,1,1).data[3])}function n(e,t,n){var i,o,r,a,s=document.createElement("canvas"),u=0,l=n,c=n;for(s.width=1,s.height=n,i=s.getContext("2d"),i.drawImage(e,0,0),o=i.getImageData(0,0,1,n).data;c>u;)r=o[4*(c-1)+3],0===r?l=c:u=c,c=l+u>>1;return a=c/n,0===a?1:a}function i(e,n,i,o){var a=document.createElement("canvas"),s=i.mime||"image/jpeg",u=new t.Promise;return r(e,n,a,i,o).then(function(){u.success(a.toDataURL(s,i.quality||.8))}),u}function o(e){if(!t.ios())throw new t.Error("Downsampled dimensions can only be reliably calculated for iOS!");if(e.origHeight*e.origWidth>5241e3)return{newHeight:Math.round(Math.sqrt(5241e3*(e.origHeight/e.origWidth))),newWidth:Math.round(Math.sqrt(5241e3*(e.origWidth/e.origHeight)))}}function r(i,r,u,l,c){var d,p=i.naturalWidth,h=i.naturalHeight,f=l.width,m=l.height,g=u.getContext("2d"),_=new t.Promise;return g.save(),l.resize?a({blob:r,canvas:u,image:i,imageHeight:h,imageWidth:p,orientation:l.orientation,resize:l.resize,targetHeight:m,targetWidth:f}):(t.supportedFeatures.unlimitedScaledImageSize||(d=o({origWidth:f,origHeight:m}),d&&(t.log(t.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h",f,m,d.newWidth,d.newHeight),"warn"),f=d.newWidth,m=d.newHeight)),s(u,f,m,l.orientation),t.ios()?function(){e(i)&&(p/=2,h/=2);var t,o,r,a=1024,s=document.createElement("canvas"),u=c?n(i,p,h):1,l=Math.ceil(a*f/p),d=Math.ceil(a*m/h/u),_=0,v=0;for(s.width=s.height=a,t=s.getContext("2d");_<h;){for(o=0,r=0;o<p;)t.clearRect(0,0,a,a),t.drawImage(i,-o,-_),g.drawImage(s,0,0,a,a,r,v,l,d),o+=a,r+=l;_+=a,v+=d}g.restore(),s=t=null}():g.drawImage(i,0,0,f,m),u.qqImageRendered&&u.qqImageRendered(),_.success(),_)}function a(e){var n=e.blob,i=e.image,o=e.imageHeight,r=e.imageWidth,a=e.orientation,u=new t.Promise,l=e.resize,c=document.createElement("canvas"),d=c.getContext("2d"),p=e.canvas,h=e.targetHeight,f=e.targetWidth;return s(c,r,o,a),p.height=h,p.width=f,d.drawImage(i,0,0),l({blob:n,height:h,image:i,sourceCanvas:c,targetCanvas:p,width:f}).then(function(){p.qqImageRendered&&p.qqImageRendered(),u.success()},u.failure),u}function s(e,t,n,i){switch(i){case 5:case 6:case 7:case 8:e.width=n,e.height=t;break;default:e.width=t,e.height=n}var o=e.getContext("2d");switch(i){case 2:o.translate(t,0),o.scale(-1,1);break;case 3:o.translate(t,n),o.rotate(Math.PI);break;case 4:o.translate(0,n),o.scale(1,-1);break;case 5:o.rotate(.5*Math.PI),o.scale(1,-1);break;case 6:o.rotate(.5*Math.PI),o.translate(0,-n);break;case 7:o.rotate(.5*Math.PI),o.translate(t,-n),o.scale(-1,1);break;case 8:o.rotate(-.5*Math.PI),o.translate(-t,0)}}function u(e,t){var n=this;window.Blob&&e instanceof Blob&&function(){var t=new Image,i=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!i)throw Error("No createObjectURL function found to create blob url");t.src=i.createObjectURL(e),n.blob=e,e=t}(),e.naturalWidth||e.naturalHeight||(e.onload=function(){var e=n.imageLoadListeners;e&&(n.imageLoadListeners=null,setTimeout(function(){for(var t=0,n=e.length;t<n;t++)e[t]()},0))},e.onerror=t,this.imageLoadListeners=[]),this.srcImage=e}u.prototype.render=function(e,n){n=n||{};var o,a=this,s=this.srcImage.naturalWidth,u=this.srcImage.naturalHeight,l=n.width,c=n.height,d=n.maxWidth,p=n.maxHeight,h=!this.blob||"image/jpeg"===this.blob.type,f=e.tagName.toLowerCase();if(this.imageLoadListeners)return void this.imageLoadListeners.push(function(){a.render(e,n)});l&&!c?c=u*l/s<<0:c&&!l?l=s*c/u<<0:(l=s,c=u),d&&l>d&&(l=d,c=u*l/s<<0),p&&c>p&&(c=p,l=s*c/u<<0),o={width:l,height:c},t.each(n,function(e,t){o[e]=t}),"img"===f?function(){var t=e.src;i(a.srcImage,a.blob,o,h).then(function(n){e.src=n,t===e.src&&e.onload&&e.onload()})}():"canvas"===f&&r(this.srcImage,this.blob,e,o,h),"function"==typeof this.onrender&&this.onrender(e)},t.MegaPixImage=u}(),t.ImageGenerator=function(e){"use strict";function n(e){return"img"===e.tagName.toLowerCase()}function i(e){return"canvas"===e.tagName.toLowerCase()}function o(){return void 0!==(new Image).crossOrigin}function r(){var e=document.createElement("canvas");return e.getContext&&e.getContext("2d")}function a(e){var n=e.split("/"),i=n[n.length-1].split("?")[0],o=t.getExtension(i);switch(o=o&&o.toLowerCase()){case"jpeg":case"jpg":return"image/jpeg";case"png":return"image/png";case"bmp":return"image/bmp";case"gif":return"image/gif";case"tiff":case"tif":return"image/tiff"}}function s(e){var n,i,o,r=document.createElement("a");return r.href=e,n=r.protocol,o=r.port,i=r.hostname,n.toLowerCase()!==window.location.protocol.toLowerCase()||(i.toLowerCase()!==window.location.hostname.toLowerCase()||o!==window.location.port&&!t.ie())}function u(t,n){t.onload=function(){t.onload=null,t.onerror=null,n.success(t)},t.onerror=function(){t.onload=null,t.onerror=null,e("Problem drawing thumbnail!","error"),n.failure(t,"Problem drawing thumbnail!")}}function l(e,t){e.qqImageRendered=function(){t.success(e)}}function c(o,r){var a=n(o)||i(o);return n(o)?u(o,r):i(o)?l(o,r):(r.failure(o),e(t.format("Element container of type {} is not supported!",o.tagName),"error")),a}function d(n,i,o){var r=new t.Promise,a=new t.Identify(n,e),s=o.maxSize,u=null==o.orient||o.orient,l=function(){i.onerror=null,i.onload=null,e("Could not render preview, file may be too large!","error"),r.failure(i,"Browser cannot render image!")};return a.isPreviewable().then(function(a){var d={parse:function(){return(new t.Promise).success()}},p=u?new t.Exif(n,e):d,h=new t.MegaPixImage(n,l);c(i,r)&&p.parse().then(function(e){var t=e&&e.Orientation;h.render(i,{maxWidth:s,maxHeight:s,orientation:t,mime:a,resize:o.customResizeFunction})},function(n){e(t.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",n)),h.render(i,{maxWidth:s,maxHeight:s,mime:a,resize:o.customResizeFunction})})},function(){e("Not previewable"),r.failure(i,"Not previewable")}),r}function p(e,n,i,o,r){var u=new Image,l=new t.Promise;c(u,l),s(e)&&(u.crossOrigin="anonymous"),u.src=e,l.then(function(){c(n,i),new t.MegaPixImage(u).render(n,{maxWidth:o,maxHeight:o,mime:a(e),resize:r})},i.failure)}function h(e,n,i,o){c(n,i),t(n).css({maxWidth:o+"px",maxHeight:o+"px"}),n.src=e}function f(e,a,u){var l=new t.Promise,d=u.scale,f=d?u.maxSize:null;return d&&n(a)?r()?s(e)&&!o()?h(e,a,l,f):p(e,a,l,f):h(e,a,l,f):i(a)?p(e,a,l,f):c(a,l)&&(a.src=e),l}t.extend(this,{generate:function(n,i,o){return t.isString(n)?(e("Attempting to update thumbnail based on server response."),f(n,i,o||{})):(e("Attempting to draw client-side image preview."),d(n,i,o||{}))}}),this._testing={},this._testing.isImg=n,this._testing.isCanvas=i,this._testing.isCrossOrigin=s,this._testing.determineMimeOfFileName=a},t.Exif=function(e,n){"use strict";function i(e){for(var t=0,n=0;e.length>0;)t+=parseInt(e.substring(0,2),16)*Math.pow(2,n),e=e.substring(2,e.length),n+=8;return t}function o(n,i){var r=n,a=i;return void 0===r&&(r=2,a=new t.Promise),t.readBlobToHex(e,r,4).then(function(e){var t,n=/^ffe([0-9])/.exec(e);n?"1"!==n[1]?(t=parseInt(e.slice(4,8),16),o(r+t+2,a)):a.success(r):a.failure("No EXIF header to be found!")}),a}function r(){var n=new t.Promise;return t.readBlobToHex(e,0,6).then(function(e){0!==e.indexOf("ffd8")?n.failure("Not a valid JPEG!"):o().then(function(e){n.success(e)},function(e){n.failure(e)})}),n}function a(n){var i=new t.Promise;return t.readBlobToHex(e,n+10,2).then(function(e){i.success("4949"===e)}),i}function s(n,o){var r=new t.Promise;return t.readBlobToHex(e,n+18,2).then(function(e){if(o)return r.success(i(e));r.success(parseInt(e,16))}),r}function u(n,i){var o=n+20,r=12*i;return t.readBlobToHex(e,o,r)}function l(e){for(var t=[],n=0;n+24<=e.length;)t.push(e.slice(n,n+24)),n+=24;return t}function c(e,n){var o=t.extend([],d),r={};return t.each(n,function(t,n){var a,s,u,l=n.slice(0,4),c=e?i(l):parseInt(l,16),d=o.indexOf(c);if(d>=0&&(s=p[c].name,u=p[c].bytes,a=n.slice(16,16+2*u),r[s]=e?i(a):parseInt(a,16),o.splice(d,1)),0===o.length)return!1}),r}var d=[274],p={274:{name:"Orientation",bytes:2}};t.extend(this,{parse:function(){var i=new t.Promise,o=function(e){n(t.format("EXIF header parse failed: '{}' ",e)),i.failure(e)};return r().then(function(r){n(t.format("Moving forward with EXIF header parsing for '{}'",void 0===e.name?"blob":e.name)),a(r).then(function(e){n(t.format("EXIF Byte order is {} endian",e?"little":"big")),s(r,e).then(function(a){n(t.format("Found {} APP1 directory entries",a)),u(r,a).then(function(t){var o=l(t),r=c(e,o);n("Successfully parsed some EXIF tags"),i.success(r)},o)},o)},o)},o),i}}),this._testing={},this._testing.parseLittleEndian=i},t.Identify=function(e,n){"use strict";function i(e,n){var i=!1,o=[].concat(e);return t.each(o,function(e,t){if(0===n.indexOf(t))return i=!0,!1}),i}t.extend(this,{isPreviewable:function(){var o=this,r=new t.Promise,a=!1,s=void 0===e.name?"blob":e.name;return n(t.format("Attempting to determine if {} can be rendered in this browser",s)),n("First pass: check type attribute of blob object."),this.isPreviewableSync()?(n("Second pass: check for magic bytes in file header."),t.readBlobToHex(e,0,4).then(function(e){t.each(o.PREVIEWABLE_MIME_TYPES,function(n,o){if(i(o,e))return("image/tiff"!==n||t.supportedFeatures.tiffPreviews)&&(a=!0,r.success(n)),!1}),n(t.format("'{}' is {} able to be rendered in this browser",s,a?"":"NOT")),a||r.failure()},function(){n("Error reading file w/ name '"+s+"'.  Not able to be rendered in this browser."),r.failure()})):r.failure(),r},isPreviewableSync:function(){var i=e.type,o=t.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),i)>=0,r=!1,a=void 0===e.name?"blob":e.name;return o&&(r="image/tiff"!==i||t.supportedFeatures.tiffPreviews),!r&&n(a+" is not previewable in this browser per the blob's type attr"),r}})},t.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]},t.ImageValidation=function(e,n){"use strict";function i(e){var n=!1;return t.each(e,function(e,t){if(t>0)return n=!0,!1}),n}function o(){var i=new t.Promise;return new t.Identify(e,n).isPreviewable().then(function(){var t=new Image,o=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;o?(t.onerror=function(){n("Cannot determine dimensions for image.  May be too large.","error"),i.failure()},t.onload=function(){i.success({width:this.width,height:this.height})},t.src=o.createObjectURL(e)):(n("No createObjectURL function available to generate image URL!","error"),i.failure())},i.failure),i}function r(e,n){var i;return t.each(e,function(e,t){if(t>0){var o=/(max|min)(Width|Height)/.exec(e),r=o[2].charAt(0).toLowerCase()+o[2].slice(1),a=n[r];switch(o[1]){case"min":if(a<t)return i=e,!1;break;case"max":if(a>t)return i=e,!1}}}),i}this.validate=function(e){var a=new t.Promise;return n("Attempting to validate image."),i(e)?o().then(function(t){var n=r(e,t);n?a.failure(n):a.success()},a.success):a.success(),a}},t.Session=function(e){"use strict";function n(e){if(t.isArray(e))return!0;o.log("Session response is not an array.","error")}function i(e,i,r,a){var s=!1;i=i&&n(e),i&&t.each(e,function(e,n){if(null==n.uuid)s=!0,o.log(t.format("Session response item {} did not include a valid UUID - ignoring.",e),"error");else if(null==n.name)s=!0,o.log(t.format("Session response item {} did not include a valid name - ignoring.",e),"error");else try{return o.addFileRecord(n),!0}catch(e){s=!0,o.log(e.message,"error")}return!1}),a[i&&!s?"success":"failure"](e,r)}var o={endpoint:null,params:{},customHeaders:{},cors:{},addFileRecord:function(e){},log:function(e,t){}};t.extend(o,e,!0),this.refresh=function(){var e=new t.Promise,n=function(t,n,o){i(t,n,o,e)},r=t.extend({},o);return new t.SessionAjaxRequester(t.extend(r,{onComplete:n})).queryServer(),e}},t.SessionAjaxRequester=function(e){"use strict";function n(e,n,i){var r=null;if(null!=n.responseText)try{r=t.parseJson(n.responseText)}catch(e){o.log("Problem parsing session response: "+e.message,"error"),i=!0}o.onComplete(r,!i,n)}var i,o={endpoint:null,customHeaders:{},params:{},cors:{expected:!1,sendCredentials:!1},onComplete:function(e,t,n){},log:function(e,t){}};t.extend(o,e),i=t.extend(this,new t.AjaxRequester({acceptHeader:"application/json",validMethods:["GET"],method:"GET",endpointStore:{get:function(){return o.endpoint}},customHeaders:o.customHeaders,log:o.log,onComplete:n,cors:o.cors})),t.extend(this,{queryServer:function(){var e=t.extend({},o.params);o.log("Session query request."),i.initTransport("sessionRefresh").withParams(e).withCacheBuster().send()}})},t.Scaler=function(e,n){"use strict";var i=e.customResizer,o=e.sendOriginal,r=e.orient,a=e.defaultType,s=e.defaultQuality/100,u=e.failureText,l=e.includeExif,c=this._getSortedSizes(e.sizes);t.extend(this,{enabled:t.supportedFeatures.scaling&&c.length>0,getFileRecords:function(e,d,p){var h=this,f=[],m=p.blob?p.blob:p;return new t.Identify(m,n).isPreviewableSync()?(t.each(c,function(e,o){var c=h._determineOutputType({defaultType:a,requestedType:o.type,refType:m.type});f.push({uuid:t.getUniqueId(),name:h._getName(d,{name:o.name,type:c,refType:m.type}),blob:new t.BlobProxy(m,t.bind(h._generateScaledImage,h,{customResizeFunction:i,maxSize:o.maxSize,orient:r,type:c,quality:s,failedText:u,includeExif:l,log:n}))})}),f.push({uuid:e,name:d,size:m.size,blob:o?m:null})):f.push({uuid:e,name:d,size:m.size,blob:m}),f},handleNewFile:function(e,n,i,o,r,a,s,u){var l=this,c=(e.qqButtonId||e.blob&&e.blob.qqButtonId,[]),d=null,p=u.addFileToHandler,h=u.uploadData,f=u.paramsStore,m=t.getUniqueId();t.each(l.getFileRecords(i,n,e),function(e,n){var i,o=n.size;n.blob instanceof t.BlobProxy&&(o=-1),i=h.addFile({uuid:n.uuid,name:n.name,size:o,batchId:a,proxyGroupId:m}),n.blob instanceof t.BlobProxy?c.push(i):d=i,n.blob?(p(i,n.blob),r.push({id:i,file:n.blob})):h.setStatus(i,t.status.REJECTED)}),null!==d&&(t.each(c,function(e,t){var n={qqparentuuid:h.retrieve({id:d}).uuid,qqparentsize:h.retrieve({id:d}).size};n[s]=h.retrieve({id:t}).uuid,h.setParentId(t,d),f.addReadOnly(t,n)}),
c.length&&function(){var e={};e[s]=h.retrieve({id:d}).uuid,f.addReadOnly(d,e)}())}})},t.extend(t.Scaler.prototype,{scaleImage:function(e,n,i){"use strict";if(!t.supportedFeatures.scaling)throw new t.Error("Scaling is not supported in this browser!");var o=new t.Promise,r=i.log,a=i.getFile(e),s=i.uploadData.retrieve({id:e}),u=s&&s.name,l=s&&s.uuid,c={customResizer:n.customResizer,sendOriginal:!1,orient:n.orient,defaultType:n.type||null,defaultQuality:n.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:n.maxSize}]},d=new t.Scaler(c,r);return t.Scaler&&t.supportedFeatures.imagePreviews&&a?t.bind(function(){var n=d.getFileRecords(l,u,a)[0];n&&n.blob instanceof t.BlobProxy?n.blob.create().then(o.success,o.failure):(r(e+" is not a scalable image!","error"),o.failure())},this)():(o.failure(),r("Could not generate requested scaled image for "+e+".  Scaling is either not possible in this browser, or the file could not be located.","error")),o},_determineOutputType:function(e){"use strict";var n=e.requestedType,i=e.defaultType,o=e.refType;return i||n?n&&t.indexOf(Object.keys(t.Identify.prototype.PREVIEWABLE_MIME_TYPES),n)>=0?"image/tiff"===n?t.supportedFeatures.tiffPreviews?n:i:n:i:"image/jpeg"!==o?"image/png":o},_getName:function(e,n){"use strict";var i=e.lastIndexOf("."),o=n.type||"image/png",r=n.refType,a="",s=t.getExtension(e),u="";return n.name&&n.name.trim().length&&(u=" ("+n.name+")"),i>=0?(a=e.substr(0,i),r!==o&&(s=o.split("/")[1]),a+=u+"."+s):a=e+u,a},_getSortedSizes:function(e){"use strict";return e=t.extend([],e),e.sort(function(e,t){return e.maxSize>t.maxSize?1:e.maxSize<t.maxSize?-1:0})},_generateScaledImage:function(e,n){"use strict";var i=this,o=e.customResizeFunction,r=e.log,a=e.maxSize,s=e.orient,u=e.type,l=e.quality,c=e.failedText,d=e.includeExif&&"image/jpeg"===n.type&&"image/jpeg"===u,p=new t.Promise,h=new t.ImageGenerator(r),f=document.createElement("canvas");return r("Attempting to generate scaled version for "+n.name),h.generate(n,f,{maxSize:a,orient:s,customResizeFunction:o}).then(function(){var e=f.toDataURL(u,l),o=function(){r("Success generating scaled version for "+n.name);var i=t.dataUriToBlob(e);p.success(i)};d?i._insertExifHeader(n,e,r).then(function(t){e=t,o()},function(){r("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.","error"),o()}):o()},function(){r("Failed attempt to generate scaled version for "+n.name,"error"),p.failure(c)}),p},_insertExifHeader:function(e,n,i){"use strict";var o=new FileReader,r=new t.Promise,a="";return o.onload=function(){a=o.result,r.success(t.ExifRestorer.restore(a,n))},o.onerror=function(){i("Problem reading "+e.name+" during attempt to transfer EXIF data to scaled version.","error"),r.failure()},o.readAsDataURL(e),r},_dataUriToBlob:function(e){"use strict";var n,i,o,r;return n=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURI(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(n.length),r=new Uint8Array(o),t.each(n,function(e,t){r[e]=t.charCodeAt(0)}),this._createBlob(o,i)},_createBlob:function(e,t){"use strict";var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,i=n&&new n;return i?(i.append(e),i.getBlob(t)):new Blob([e],{type:t})}}),t.ExifRestorer=function(){var e={};return e.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.encode64=function(e){var t,n,i,o,r,a="",s="",u="",l=0;do t=e[l++],n=e[l++],s=e[l++],i=t>>2,o=(3&t)<<4|n>>4,r=(15&n)<<2|s>>6,u=63&s,isNaN(n)?r=u=64:isNaN(s)&&(u=64),a=a+this.KEY_STR.charAt(i)+this.KEY_STR.charAt(o)+this.KEY_STR.charAt(r)+this.KEY_STR.charAt(u),t=n=s="",i=o=r=u="";while(l<e.length);return a},e.restore=function(e,t){if(!e.match("data:image/jpeg;base64,"))return t;var n=this.decode64(e.replace("data:image/jpeg;base64,","")),i=this.slice2Segments(n),o=this.exifManipulation(t,i);return"data:image/jpeg;base64,"+this.encode64(o)},e.exifManipulation=function(e,t){var n=this.getExifArray(t),i=this.insertExif(e,n);return new Uint8Array(i)},e.getExifArray=function(e){for(var t,n=0;n<e.length;n++)if(t=e[n],255==t[0]&225==t[1])return t;return[]},e.insertExif=function(e,t){var n=e.replace("data:image/jpeg;base64,",""),i=this.decode64(n),o=i.indexOf(255,3),r=i.slice(0,o),a=i.slice(o),s=r;return s=s.concat(t),s=s.concat(a)},e.slice2Segments=function(e){for(var t=0,n=[];;){if(255==e[t]&218==e[t+1])break;if(255==e[t]&216==e[t+1])t+=2;else{var i=256*e[t+2]+e[t+3],o=t+i+2,r=e.slice(t,o);n.push(r),t=o}if(t>e.length)break}return n},e.decode64=function(e){var t,n,i,o,r,a="",s="",u=0,l=[];if(/[^A-Za-z0-9\+\/\=]/g.exec(e))throw new Error("There were invalid base64 characters in the input text.  Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do i=this.KEY_STR.indexOf(e.charAt(u++)),o=this.KEY_STR.indexOf(e.charAt(u++)),r=this.KEY_STR.indexOf(e.charAt(u++)),s=this.KEY_STR.indexOf(e.charAt(u++)),t=i<<2|o>>4,n=(15&o)<<4|r>>2,a=(3&r)<<6|s,l.push(t),64!=r&&l.push(n),64!=s&&l.push(a),t=n=a="",i=o=r=s="";while(u<e.length);return l},e}(),t.TotalProgress=function(e,n){"use strict";var i={},o=0,r=0,a=-1,s=-1,u=function(t,n){t===a&&n===s||e(t,n),a=t,s=n},l=function(e,n){var i=!0;return t.each(e,function(e,o){if(t.indexOf(n,o)>=0)return i=!1,!1}),i},c=function(e){h(e,-1,-1),delete i[e]},d=function(e,t,n){(0===t.length||l(t,n))&&(u(r,r),this.reset())},p=function(e){var t=n(e);t>0&&(h(e,0,t),i[e]={loaded:0,total:t})},h=function(e,t,n){var a=i[e]?i[e].loaded:0,s=i[e]?i[e].total:0;t===-1&&n===-1?(o-=a,r-=s):(t&&(o+=t-a),n&&(r+=n-s)),u(o,r)};t.extend(this,{onAllComplete:d,onStatusChange:function(e,n,i){i===t.status.CANCELED||i===t.status.REJECTED?c(e):i===t.status.SUBMITTING&&p(e)},onIndividualProgress:function(e,t,n){h(e,t,n),i[e]={loaded:t,total:n}},onNewSize:function(e){p(e)},reset:function(){i={},o=0,r=0}})},t.PasteSupport=function(e){"use strict";function n(e){return e.type&&0===e.type.indexOf("image/")}function i(){a=t(r.targetElement).attach("paste",function(e){var i=e.clipboardData;i&&t.each(i.items,function(e,t){if(n(t)){var i=t.getAsFile();r.callbacks.pasteReceived(i)}})})}function o(){a&&a()}var r,a;r={targetElement:null,callbacks:{log:function(e,t){},pasteReceived:function(e){}}},t.extend(r,e),i(),t.extend(this,{reset:function(){o()}})},t.FormSupport=function(e,n,i){"use strict";function o(e){e.getAttribute("action")&&(u.newEndpoint=e.getAttribute("action"))}function r(e,t){if(!e.checkValidity||e.checkValidity())return!0;i("Form did not pass validation checks - will not upload.","error"),t()}function a(e){var i=e.submit;t(e).attach("submit",function(t){t=t||window.event,t.preventDefault?t.preventDefault():t.returnValue=!1,r(e,i)&&n()}),e.submit=function(){r(e,i)&&n()}}function s(e){return e&&(t.isString(e)&&(e=document.getElementById(e)),e&&(i("Attaching to form element."),o(e),l&&a(e))),e}var u=this,l=e.interceptSubmit,c=e.element,d=e.autoUpload;t.extend(this,{newEndpoint:null,newAutoUpload:d,attachedToForm:!1,getFormInputsAsObject:function(){return null==c?null:u._form2Obj(c)}}),c=s(c),this.attachedToForm=!!c},t.extend(t.FormSupport.prototype,{_form2Obj:function(e){"use strict";var n={},i=function(e){var n=["button","image","reset","submit"];return t.indexOf(n,e.toLowerCase())<0},o=function(e){return t.indexOf(["checkbox","radio"],e.toLowerCase())>=0},r=function(e){return!(!o(e.type)||e.checked)||e.disabled&&"hidden"!==e.type.toLowerCase()},a=function(e){var n=null;return t.each(t(e).children(),function(e,t){if("option"===t.tagName.toLowerCase()&&t.selected)return n=t.value,!1}),n};return t.each(e.elements,function(e,o){if(!t.isInput(o,!0)&&"textarea"!==o.tagName.toLowerCase()||!i(o.type)||r(o)){if("select"===o.tagName.toLowerCase()&&!r(o)){var s=a(o);null!==s&&(n[o.name]=s)}}else n[o.name]=o.value}),n}}),t.traditional=t.traditional||{},t.traditional.FormUploadHandler=function(e,n){"use strict";function i(e,t){var n,i,o;try{i=t.contentDocument||t.contentWindow.document,o=i.body.innerHTML,u("converting iframe's innerHTML to JSON"),u("innerHTML = "+o),o&&o.match(/^<pre/i)&&(o=i.body.firstChild.firstChild.nodeValue),n=r._parseJsonResponse(o)}catch(e){u("Error when attempting to parse form upload response ("+e.message+")","error"),n={success:!1}}return n}function o(t,n){var i=e.paramsStore.get(t),o="get"===e.method.toLowerCase()?"GET":"POST",u=e.endpointStore.get(t),l=a(t);return i[e.uuidName]=s(t),i[e.filenameParam]=l,r._initFormForUpload({method:o,endpoint:u,params:i,paramsInBody:e.paramsInBody,targetName:n.name})}var r=this,a=n.getName,s=n.getUuid,u=n.log;this.uploadFile=function(n){var a,s=r.getInput(n),l=r._createIframe(n),c=new t.Promise;return a=o(n,l),a.appendChild(s),r._attachLoadEvent(l,function(o){u("iframe loaded");var a=o?o:i(n,l);r._detachLoadEvent(n),e.cors.expected||t(l).remove(),a.success?c.success(a):c.failure(a)}),u("Sending upload request for "+n),a.submit(),t(a).remove(),c},t.extend(this,new t.FormUploadHandler({options:{isCors:e.cors.expected,inputName:e.inputName},proxy:{onCancel:e.onCancel,getName:a,getUuid:s,log:u}}))},t.traditional=t.traditional||{},t.traditional.XhrUploadHandler=function(e,n){"use strict";var i=this,o=n.getName,r=n.getSize,a=n.getUuid,s=n.log,u=e.forceMultipart||e.paramsInBody,l=function(t,n,i){var a=r(t),s=o(t);e.omitDefaultParams||(n[e.chunking.paramNames.partIndex]=i.part,n[e.chunking.paramNames.partByteOffset]=i.start,n[e.chunking.paramNames.chunkSize]=i.size,n[e.chunking.paramNames.totalParts]=i.count,n[e.totalFileSizeName]=a),u&&!e.omitDefaultParams&&(n[e.filenameParam]=s)},c=new t.traditional.AllChunksDoneAjaxRequester({cors:e.cors,endpoint:e.chunking.success.endpoint,headers:e.chunking.success.headers,jsonPayload:e.chunking.success.jsonPayload,log:s,method:e.chunking.success.method,params:e.chunking.success.params}),d=function(e,n){var i=new t.Promise;return n.onreadystatechange=function(){if(4===n.readyState){var t=f(e,n);t.success?i.success(t.response,n):i.failure(t.response,n)}},i},p=function(t){var n=e.paramsStore.get(t),s=o(t),u=r(t);return n[e.uuidName]=a(t),n[e.filenameParam]=s,n[e.totalFileSizeName]=u,n[e.chunking.paramNames.totalParts]=i._getTotalChunks(t),n},h=function(n,i){return t.indexOf([200,201,202,203,204],n.status)<0||e.requireSuccessJson&&!i.success||i.reset},f=function(e,t){var n;return s("xhr - server response received for "+e),s("responseText = "+t.responseText),n=m(!0,t),{success:!h(t,n),response:n}},m=function(n,i){var o={};try{s(t.format("Received response status {} with body: {}",i.status,i.responseText)),o=t.parseJson(i.responseText)}catch(t){n&&e.requireSuccessJson&&s("Error when attempting to parse xhr response text ("+t.message+")","error")}return o},g=function(n){var o=new t.Promise;return c.complete(n,i._createXhr(n),p(n),e.customHeaders.get(n)).then(function(e){o.success(m(!1,e),e)},function(e){o.failure(m(!1,e),e)}),o},_=function(n){var i,s=n.fileOrBlob,l=n.id,c=n.xhr,d=n.xhrOverrides||{},p=n.customParams||{},h=n.params||{},f=d.params||{},m=u?new FormData:null,g=d.method||e.method,_=d.endpoint||e.endpointStore.get(l),v=o(l),b=r(l);return e.omitDefaultParams?(i=t.extend({},p),t.extend(i,f)):(i=t.extend({},p),t.extend(i,f),t.extend(i,h),i[e.uuidName]=a(l),i[e.filenameParam]=v,u?i[e.totalFileSizeName]=b:e.paramsInBody||(i[e.inputName]=v)),e.paramsInBody||(_=t.obj2url(i,_)),c.open(g,_,!0),e.cors.expected&&e.cors.sendCredentials&&(c.withCredentials=!0),u?(e.paramsInBody&&t.obj2FormData(i,m),m.append(e.inputName,s),m):s},v=function(n){var o=n.headerOverrides,r=n.id,a=n.xhr;if(o)t.each(o,function(e,t){a.setRequestHeader(e,t)});else{var s=e.customHeaders.get(r),l=i.getFile(r);a.setRequestHeader("Accept","application/json"),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Cache-Control","no-cache"),u||(a.setRequestHeader("Content-Type","application/octet-stream"),a.setRequestHeader("X-Mime-Type",l.type)),t.each(s,function(e,t){a.setRequestHeader(e,t)})}};t.extend(this,{uploadChunk:function(t){var n,o,r,a=t.id,s=t.chunkIdx,u=t.overrides||{},c=t.resuming,p=i._getChunkData(a,s),h=i._createXhr(a,s),f={};return n=d(a,h),i._registerProgressHandler(a,s,p.size),r=e.paramsStore.get(a),l(a,f,p),c&&(f[e.resume.paramNames.resuming]=!0),o=_({fileOrBlob:p.blob,id:a,customParams:r,params:f,xhr:h,xhrOverrides:u}),v({headerOverrides:u.headers,id:a,xhr:h}),h.send(o),n},uploadFile:function(t){var n,o,r,a,s=i.getFile(t);return o=i._createXhr(t),i._registerProgressHandler(t),n=d(t,o),r=e.paramsStore.get(t),a=_({fileOrBlob:s,id:t,customParams:r,xhr:o}),v({id:t,xhr:o}),o.send(a),n}}),t.extend(this,new t.XhrUploadHandler({options:t.extend({namespace:"traditional"},e),proxy:t.extend({getEndpoint:e.endpointStore.get},n)})),t.override(this,function(i){return{finalizeChunks:function(o){return n.onFinalizing(o),e.chunking.success.endpoint?g(o):i.finalizeChunks(o,t.bind(m,this,!0))}}})},t.traditional.AllChunksDoneAjaxRequester=function(e){"use strict";var n,i={cors:{allowXdr:!1,expected:!1,sendCredentials:!1},endpoint:null,log:function(e,t){},method:"POST"},o={},r={get:function(e){return t.isFunction(i.endpoint)?i.endpoint(e):i.endpoint}};t.extend(i,e),n=t.extend(this,new t.AjaxRequester({acceptHeader:"application/json",contentType:i.jsonPayload?"application/json":"application/x-www-form-urlencoded",validMethods:[i.method],method:i.method,endpointStore:r,allowXRequestedWithAndCacheControl:!1,cors:i.cors,log:i.log,onComplete:function(e,t,n){var i=o[e];delete o[e],n?i.failure(t):i.success(t)}})),t.extend(this,{complete:function(e,r,a,s){var u=new t.Promise;return i.log("Submitting All Chunks Done request for "+e),o[e]=u,n.initTransport(e).withParams(i.params(e)||a).withHeaders(i.headers(e)||s).send(r),u}})},t.DragAndDrop=function(e){"use strict";function n(e,t){var n=Array.prototype.slice.call(e);d.callbacks.dropLog("Grabbed "+e.length+" dropped files."),t.dropDisabled(!1),d.callbacks.processingDroppedFilesComplete(n,t.getElement())}function i(e){var n=new t.Promise;return e.isFile?e.file(function(t){t.qqPath=o(e),h.push(t),n.success()},function(t){d.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+t.code+".","error"),n.failure()}):e.isDirectory&&r(e).then(function(e){var o=e.length;t.each(e,function(e,t){i(t).done(function(){o-=1,0===o&&n.success()})}),e.length||n.success()},function(t){d.callbacks.dropLog("Problem parsing '"+e.fullPath+"'.  FileError code "+t.code+".","error"),n.failure()}),n}function o(e){var t=e.name,n=e.fullPath,i=n.lastIndexOf(t);return n=n.substr(0,i),"/"===n.charAt(0)&&(n=n.substr(1)),n}function r(e,n,i,o){var a=o||new t.Promise,s=n||e.createReader();return s.readEntries(function(t){var n=i?i.concat(t):t;t.length?setTimeout(function(){r(e,s,n,a)},0):a.success(n)},a.failure),a}function a(e,n){var o=[],r=new t.Promise;return d.callbacks.processingDroppedFiles(),n.dropDisabled(!0),e.files.length>1&&!d.allowMultipleItems?(d.callbacks.processingDroppedFilesComplete([]),d.callbacks.dropError("tooManyFilesError",""),n.dropDisabled(!1),r.failure()):(h=[],t.isFolderDropSupported(e)?t.each(e.items,function(e,t){var n=t.webkitGetAsEntry();n&&(n.isFile?h.push(t.getAsFile()):o.push(i(n).done(function(){o.pop(),0===o.length&&r.success()})))}):h=e.files,0===o.length&&r.success()),r}function s(e){var i=new t.UploadDropZone({HIDE_ZONES_EVENT_NAME:"qq-hidezones",element:e,onEnter:function(n){t(e).addClass(d.classes.dropActive),d.callbacks.dragEnter(),n.stopPropagation()},onLeaveNotDescendants:function(n){t(e).removeClass(d.classes.dropActive),d.callbacks.dragLeave()},onDrop:function(e){a(e.dataTransfer,i).then(function(){n(h,i)},function(){d.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.","error")})}});return f.addDisposer(function(){i.dispose()}),t(e).hasAttribute("qq-hide-dropzone")&&t(e).hide(),p.push(i),i}function u(e){var n;return t.each(e.dataTransfer.types,function(e,t){if("Files"===t)return n=!0,!1}),n}function l(e){return t.safari()?e.x<0||e.y<0:0===e.x&&0===e.y}function c(){var e=d.dropZoneElements,n=function(){setTimeout(function(){t.each(e,function(e,n){t(n).hasAttribute("qq-hide-dropzone")&&t(n).hide(),t(n).removeClass(d.classes.dropActive)})},10)};t.each(e,function(n,i){var o=s(i);e.length&&t.supportedFeatures.fileDrop&&f.attach(document,"dragenter",function(n){!o.dropDisabled()&&u(n)&&t.each(e,function(e,n){n instanceof HTMLElement&&t(n).hasAttribute("qq-hide-dropzone")&&t(n).css({display:"block"})})})}),f.attach(document,"dragleave",function(e){l(e)&&n()}),f.attach(t(document).children()[0],"mouseenter",function(e){n()}),f.attach(document,"drop",function(e){u(e)&&(e.preventDefault(),n())}),f.attach(document,"qq-hidezones",n)}var d,p=[],h=[],f=new t.DisposeSupport;d={dropZoneElements:[],allowMultipleItems:!0,classes:{dropActive:null},callbacks:new t.DragAndDrop.callbacks},t.extend(d,e,!0),c(),t.extend(this,{setupExtraDropzone:function(e){d.dropZoneElements.push(e),s(e)},removeDropzone:function(e){var t,n=d.dropZoneElements;for(t in n)if(n[t]===e)return n.splice(t,1)},dispose:function(){f.dispose(),t.each(p,function(e,t){t.dispose()})}}),this._testing={},this._testing.extractDirectoryPath=o},t.DragAndDrop.callbacks=function(){"use strict";return{dragEnter:function(){},dragLeave:function(){},processingDroppedFiles:function(){},processingDroppedFilesComplete:function(e,t){},dropError:function(e,n){t.log("Drag & drop error code '"+e+" with these specifics: '"+n+"'","error")},dropLog:function(e,n){t.log(e,n)}}},t.UploadDropZone=function(e){"use strict";function n(){return t.safari()||t.firefox()&&t.windows()}function i(e){d||(n?p.attach(document,"dragover",function(e){e.preventDefault()}):p.attach(document,"dragover",function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.preventDefault())}),d=!0)}function o(e){if(!t.supportedFeatures.fileDrop)return!1;var n,i=e.dataTransfer,o=t.safari();return n=!(!t.ie()||!t.supportedFeatures.fileDrop)||"none"!==i.effectAllowed,i&&n&&(i.files&&i.files.length||!o&&i.types.contains&&i.types.contains("Files")||i.types.includes&&i.types.includes("Files"))}function r(e){return void 0!==e&&(c=e),c}function a(){function e(){t=document.createEvent("Event"),t.initEvent(u.HIDE_ZONES_EVENT_NAME,!0,!0)}var t;if(window.CustomEvent)try{t=new CustomEvent(u.HIDE_ZONES_EVENT_NAME)}catch(t){e()}else e();document.dispatchEvent(t)}function s(){p.attach(l,"dragover",function(e){if(o(e)){var n=t.ie()&&t.supportedFeatures.fileDrop?null:e.dataTransfer.effectAllowed;e.dataTransfer.dropEffect="move"===n||"linkMove"===n?"move":"copy",e.stopPropagation(),e.preventDefault()}}),p.attach(l,"dragenter",function(e){if(!r()){if(!o(e))return;u.onEnter(e)}}),p.attach(l,"dragleave",function(e){if(o(e)){u.onLeave(e);var n=document.elementFromPoint(e.clientX,e.clientY);t(this).contains(n)||u.onLeaveNotDescendants(e)}}),p.attach(l,"drop",function(e){if(!r()){if(!o(e))return;e.preventDefault(),e.stopPropagation(),u.onDrop(e),a()}})}var u,l,c,d,p=new t.DisposeSupport;u={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}},t.extend(u,e),l=u.element,i(),s(),t.extend(this,{dropDisabled:function(e){return r(e)},dispose:function(){p.dispose()},getElement:function(){return l}}),this._testing={},this._testing.isValidFileDrag=o},function(){"use strict";t.uiPublicApi={addInitialFiles:function(e){this._parent.prototype.addInitialFiles.apply(this,arguments),this._templating.addCacheToDom()},clearStoredFiles:function(){this._parent.prototype.clearStoredFiles.apply(this,arguments),this._templating.clearFiles()},addExtraDropzone:function(e){this._dnd&&this._dnd.setupExtraDropzone(e)},removeExtraDropzone:function(e){if(this._dnd)return this._dnd.removeDropzone(e)},getItemByFileId:function(e){if(!this._templating.isHiddenForever(e))return this._templating.getFileContainer(e)},reset:function(){this._parent.prototype.reset.apply(this,arguments),this._templating.reset(),!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton(),title:this._options.text.fileInputTitle}).getButtonId()),this._dnd&&(this._dnd.dispose(),this._dnd=this._setupDragAndDrop()),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0,this._setupClickAndEditEventHandlers()},setName:function(e,t){var n=this._options.formatFileName(t);this._parent.prototype.setName.apply(this,arguments),this._templating.updateFilename(e,n)},pauseUpload:function(e){var t=this._parent.prototype.pauseUpload.apply(this,arguments);return t&&this._templating.uploadPaused(e),t},continueUpload:function(e){var t=this._parent.prototype.continueUpload.apply(this,arguments);return t&&this._templating.uploadContinued(e),t},getId:function(e){return this._templating.getFileId(e)},getDropTarget:function(e){return this.getFile(e).qqDropTarget}},t.uiPrivateApi={_getButton:function(e){var t=this._parent.prototype._getButton.apply(this,arguments);return t||e===this._defaultButtonId&&(t=this._templating.getButton()),t},_removeFileItem:function(e){this._templating.removeFile(e)},_setupClickAndEditEventHandlers:function(){this._fileButtonsClickHandler=t.FileButtonsClickHandler&&this._bindFileButtonsClickEvent(),this._focusinEventSupported=!t.firefox(),this._isEditFilenameEnabled()&&(this._filenameClickHandler=this._bindFilenameClickEvent(),this._filenameInputFocusInHandler=this._bindFilenameInputFocusInEvent(),this._filenameInputFocusHandler=this._bindFilenameInputFocusEvent())},_setupDragAndDrop:function(){var e=this,n=this._options.dragAndDrop.extraDropzones,i=this._templating,o=i.getDropZone();return o&&n.push(o),new t.DragAndDrop({dropZoneElements:n,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){i.showDropProcessing()},processingDroppedFilesComplete:function(n,o){i.hideDropProcessing(),t.each(n,function(e,t){t.qqDropTarget=o}),n.length&&e.addFiles(n,null,null)},dropError:function(t,n){e._itemError(t,n)},dropLog:function(t,n){e.log(t,n)}}})},_bindFileButtonsClickEvent:function(){var e=this;return new t.FileButtonsClickHandler({templating:this._templating,log:function(t,n){e.log(t,n)},onDeleteFile:function(t){e.deleteFile(t)},onCancel:function(t){e.cancel(t)},onRetry:function(t){e.retry(t)},onPause:function(t){e.pauseUpload(t)},onContinue:function(t){e.continueUpload(t)},onGetName:function(t){return e.getName(t)}})},_isEditFilenameEnabled:function(){return this._templating.isEditFilenamePossible()&&!this._options.autoUpload&&t.FilenameClickHandler&&t.FilenameInputFocusHandler&&t.FilenameInputFocusHandler},_filenameEditHandler:function(){var e=this,n=this._templating;return{templating:n,log:function(t,n){e.log(t,n)},onGetUploadStatus:function(t){return e.getUploads({id:t}).status},onGetName:function(t){return e.getName(t)},onSetName:function(t,n){e.setName(t,n)},onEditingStatusChange:function(e,i){var o=t(n.getEditInput(e)),r=t(n.getFileContainer(e));i?(o.addClass("qq-editing"),n.hideFilename(e),n.hideEditIcon(e)):(o.removeClass("qq-editing"),n.showFilename(e),n.showEditIcon(e)),r.addClass("qq-temp").removeClass("qq-temp")}}},_onUploadStatusChange:function(e,n,i){this._parent.prototype._onUploadStatusChange.apply(this,arguments),this._isEditFilenameEnabled()&&this._templating.getFileContainer(e)&&i!==t.status.SUBMITTED&&(this._templating.markFilenameEditable(e),this._templating.hideEditIcon(e)),n===t.status.UPLOAD_RETRYING&&i===t.status.UPLOADING?(this._templating.hideRetry(e),this._templating.setStatusText(e),t(this._templating.getFileContainer(e)).removeClass(this._classes.retrying)):i===t.status.UPLOAD_FAILED&&this._templating.hidePause(e)},_bindFilenameInputFocusInEvent:function(){var e=t.extend({},this._filenameEditHandler());return new t.FilenameInputFocusInHandler(e)},_bindFilenameInputFocusEvent:function(){var e=t.extend({},this._filenameEditHandler());return new t.FilenameInputFocusHandler(e)},_bindFilenameClickEvent:function(){var e=t.extend({},this._filenameEditHandler());return new t.FilenameClickHandler(e)},_storeForLater:function(e){this._parent.prototype._storeForLater.apply(this,arguments),this._templating.hideSpinner(e)},_onAllComplete:function(e,t){this._parent.prototype._onAllComplete.apply(this,arguments),this._templating.resetTotalProgress()},_onSubmit:function(e,t){var n=this.getFile(e);n&&n.qqPath&&this._options.dragAndDrop.reportDirectoryPaths&&this._paramsStore.addReadOnly(e,{qqpath:n.qqPath}),this._parent.prototype._onSubmit.apply(this,arguments),this._addToList(e,t)},_onSubmitted:function(e){this._isEditFilenameEnabled()&&(this._templating.markFilenameEditable(e),this._templating.showEditIcon(e),this._focusinEventSupported||this._filenameInputFocusHandler.addHandler(this._templating.getEditInput(e)))},_onProgress:function(e,t,n,i){this._parent.prototype._onProgress.apply(this,arguments),this._templating.updateProgress(e,n,i),0===i||100===Math.round(n/i*100)?(this._templating.hideCancel(e),this._templating.hidePause(e),this._templating.hideProgress(e),this._templating.setStatusText(e,this._options.text.waitingForResponse),this._displayFileSize(e)):this._displayFileSize(e,n,i)},_onTotalProgress:function(e,t){this._parent.prototype._onTotalProgress.apply(this,arguments),this._templating.updateTotalProgress(e,t)},_onComplete:function(e,n,i,o){function r(n){u&&(s.setStatusText(e),t(u).removeClass(l._classes.retrying),s.hideProgress(e),l.getUploads({id:e}).status!==t.status.UPLOAD_FAILED&&s.hideCancel(e),s.hideSpinner(e),n.success?l._markFileAsSuccessful(e):(t(u).addClass(l._classes.fail),s.showCancel(e),s.isRetryPossible()&&!l._preventRetries[e]&&(t(u).addClass(l._classes.retryable),s.showRetry(e)),l._controlFailureTextDisplay(e,n)))}var a=this._parent.prototype._onComplete.apply(this,arguments),s=this._templating,u=s.getFileContainer(e),l=this;return a instanceof t.Promise?a.done(function(e){r(e)}):r(i),a},_markFileAsSuccessful:function(e){var n=this._templating;this._isDeletePossible()&&n.showDeleteButton(e),t(n.getFileContainer(e)).addClass(this._classes.success),this._maybeUpdateThumbnail(e)},_onUploadPrep:function(e){this._parent.prototype._onUploadPrep.apply(this,arguments),this._templating.showSpinner(e)},_onUpload:function(e,t){var n=this._parent.prototype._onUpload.apply(this,arguments);return this._templating.showSpinner(e),n},_onUploadChunk:function(e,t){this._parent.prototype._onUploadChunk.apply(this,arguments),t.partIndex>0&&this._handler.isResumable(e)&&this._templating.allowPause(e)},_onCancel:function(e,t){this._parent.prototype._onCancel.apply(this,arguments),this._removeFileItem(e),0===this._getNotFinished()&&this._templating.resetTotalProgress()},_onBeforeAutoRetry:function(e){var n,i,o;this._parent.prototype._onBeforeAutoRetry.apply(this,arguments),this._showCancelLink(e),this._options.retry.showAutoRetryNote&&(n=this._autoRetries[e],i=this._options.retry.maxAutoAttempts,o=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,n),o=o.replace(/\{maxAuto\}/g,i),this._templating.setStatusText(e,o),t(this._templating.getFileContainer(e)).addClass(this._classes.retrying))},_onBeforeManualRetry:function(e){return this._parent.prototype._onBeforeManualRetry.apply(this,arguments)?(this._templating.resetProgress(e),t(this._templating.getFileContainer(e)).removeClass(this._classes.fail),this._templating.setStatusText(e),this._templating.showSpinner(e),this._showCancelLink(e),!0):(t(this._templating.getFileContainer(e)).addClass(this._classes.retryable),this._templating.showRetry(e),!1)},_onSubmitDelete:function(e){var n=t.bind(this._onSubmitDeleteSuccess,this);this._parent.prototype._onSubmitDelete.call(this,e,n)},_onSubmitDeleteSuccess:function(e,t,n){this._options.deleteFile.forceConfirm?this._showDeleteConfirm.apply(this,arguments):this._sendDeleteRequest.apply(this,arguments)},_onDeleteComplete:function(e,t,n){this._parent.prototype._onDeleteComplete.apply(this,arguments),this._templating.hideSpinner(e),n?(this._templating.setStatusText(e,this._options.deleteFile.deletingFailedText),this._templating.showDeleteButton(e)):this._removeFileItem(e)},_sendDeleteRequest:function(e,t,n){this._templating.hideDeleteButton(e),this._templating.showSpinner(e),this._templating.setStatusText(e,this._options.deleteFile.deletingStatusText),this._deleteHandler.sendDelete.apply(this,arguments)},_showDeleteConfirm:function(e,n,i){var o,r=this.getName(e),a=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,r),s=(this.getUuid(e),arguments),u=this;o=this._options.showConfirm(a),t.isGenericPromise(o)?o.then(function(){u._sendDeleteRequest.apply(u,s)}):o!==!1&&u._sendDeleteRequest.apply(u,s)},_addToList:function(e,n,i){var o,r,a=0,s=this._handler.isProxied(e)&&this._options.scaling.hideScaled;this._options.display.prependFiles&&(this._totalFilesInBatch>1&&this._filesInBatchAddedToUi>0&&(a=this._filesInBatchAddedToUi-1),o={index:a}),i||(this._options.disableCancelForFormUploads&&!t.supportedFeatures.ajaxUploading&&this._templating.disableCancel(),this._options.multiple||(r=this.getUploads({id:e}),this._handledProxyGroup=this._handledProxyGroup||r.proxyGroupId,r.proxyGroupId===this._handledProxyGroup&&r.proxyGroupId||(this._handler.cancelAll(),this._clearList(),this._handledProxyGroup=null))),i?(this._templating.addFileToCache(e,this._options.formatFileName(n),o,s),this._templating.updateThumbnail(e,this._thumbnailUrls[e],!0,this._options.thumbnails.customResizer)):(this._templating.addFile(e,this._options.formatFileName(n),o,s),this._templating.generatePreview(e,this.getFile(e),this._options.thumbnails.customResizer)),this._filesInBatchAddedToUi+=1,(i||this._options.display.fileSizeOnSubmit&&t.supportedFeatures.ajaxUploading)&&this._displayFileSize(e)},_clearList:function(){this._templating.clearFiles(),this.clearStoredFiles()},_displayFileSize:function(e,t,n){var i=this.getSize(e),o=this._formatSize(i);i>=0&&(void 0!==t&&void 0!==n&&(o=this._formatProgress(t,n)),this._templating.updateSize(e,o))},_formatProgress:function(e,t){function n(e,t){i=i.replace(e,t)}var i=this._options.text.formatProgress;return n("{percent}",Math.round(e/t*100)),n("{total_size}",this._formatSize(t)),i},_controlFailureTextDisplay:function(e,t){var n,i,o;n=this._options.failedUploadTextDisplay.mode,i=this._options.failedUploadTextDisplay.responseProperty,"custom"===n?(o=t[i],o||(o=this._options.text.failUpload),this._templating.setStatusText(e,o),this._options.failedUploadTextDisplay.enableTooltip&&this._showTooltip(e,o)):"default"===n?this._templating.setStatusText(e,this._options.text.failUpload):"none"!==n&&this.log("failedUploadTextDisplay.mode value of '"+n+"' is not valid","warn")},_showTooltip:function(e,t){this._templating.getFileContainer(e).title=t},_showCancelLink:function(e){this._options.disableCancelForFormUploads&&!t.supportedFeatures.ajaxUploading||this._templating.showCancel(e)},_itemError:function(e,t,n){var i=this._parent.prototype._itemError.apply(this,arguments);this._options.showMessage(i)},_batchError:function(e){this._parent.prototype._batchError.apply(this,arguments),this._options.showMessage(e)},_setupPastePrompt:function(){var e=this;this._options.callbacks.onPasteReceived=function(){var t=e._options.paste.namePromptMessage,n=e._options.paste.defaultName;return e._options.showPrompt(t,n)}},_fileOrBlobRejected:function(e,t){this._totalFilesInBatch-=1,this._parent.prototype._fileOrBlobRejected.apply(this,arguments)},_prepareItemsForUpload:function(e,t,n){this._totalFilesInBatch=e.length,this._filesInBatchAddedToUi=0,this._parent.prototype._prepareItemsForUpload.apply(this,arguments)},_maybeUpdateThumbnail:function(e){var n=this._thumbnailUrls[e];this.getUploads({id:e}).status===t.status.DELETED||!n&&!this._options.thumbnails.placeholders.waitUntilResponse&&t.supportedFeatures.imagePreviews||this._templating.updateThumbnail(e,n,this._options.thumbnails.customResizer)},_addCannedFile:function(e){var t=this._parent.prototype._addCannedFile.apply(this,arguments)
;return this._addToList(t,this.getName(t),!0),this._templating.hideSpinner(t),this._templating.hideCancel(t),this._markFileAsSuccessful(t),t},_setSize:function(e,t){this._parent.prototype._setSize.apply(this,arguments),this._templating.updateSize(e,this._formatSize(t))},_sessionRequestComplete:function(){this._templating.addCacheToDom(),this._parent.prototype._sessionRequestComplete.apply(this,arguments)}}}(),t.FineUploader=function(e,n){"use strict";var i=this;this._parent=n?t[n].FineUploaderBasic:t.FineUploaderBasic,this._parent.apply(this,arguments),t.extend(this._options,{element:null,button:null,listElement:null,dragAndDrop:{extraDropzones:[],reportDirectoryPaths:!1},text:{formatProgress:"{percent}% of {total_size}",failUpload:"Upload failed",waitingForResponse:"Processing...",paused:"Paused"},template:"qq-template",classes:{retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",success:"qq-upload-success",fail:"qq-upload-fail",editable:"qq-editable",hide:"qq-hide",dropActive:"qq-upload-drop-area-active"},failedUploadTextDisplay:{mode:"default",responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}..."},deleteFile:{forceConfirm:!1,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:!1,prependFiles:!1},paste:{promptForName:!1,namePromptMessage:"Please name this image"},thumbnails:{customResizer:null,maxCount:0,placeholders:{waitUntilResponse:!1,notAvailablePath:null,waitingPath:null},timeBetweenThumbs:750},scaling:{hideScaled:!1},showMessage:function(e){if(i._templating.hasDialog("alert"))return i._templating.showDialog("alert",e);setTimeout(function(){window.alert(e)},0)},showConfirm:function(e){return i._templating.hasDialog("confirm")?i._templating.showDialog("confirm",e):window.confirm(e)},showPrompt:function(e,t){return i._templating.hasDialog("prompt")?i._templating.showDialog("prompt",e,t):window.prompt(e,t)}},!0),t.extend(this._options,e,!0),this._templating=new t.Templating({log:t.bind(this.log,this),templateIdOrEl:this._options.template,containerEl:this._options.element,fileContainerEl:this._options.listElement,button:this._options.button,imageGenerator:this._imageGenerator,classes:{hide:this._options.classes.hide,editable:this._options.classes.editable},limits:{maxThumbs:this._options.thumbnails.maxCount,timeBetweenThumbs:this._options.thumbnails.timeBetweenThumbs},placeholders:{waitUntilUpdate:this._options.thumbnails.placeholders.waitUntilResponse,thumbnailNotAvailable:this._options.thumbnails.placeholders.notAvailablePath,waitingForThumbnail:this._options.thumbnails.placeholders.waitingPath},text:this._options.text}),this._options.workarounds.ios8SafariUploads&&t.ios800()&&t.iosSafari()?this._templating.renderFailure(this._options.messages.unsupportedBrowserIos8Safari):!t.supportedFeatures.uploading||this._options.cors.expected&&!t.supportedFeatures.uploadCors?this._templating.renderFailure(this._options.messages.unsupportedBrowser):(this._wrapCallbacks(),this._templating.render(),this._classes=this._options.classes,!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton(),title:this._options.text.fileInputTitle}).getButtonId()),this._setupClickAndEditEventHandlers(),t.DragAndDrop&&t.supportedFeatures.fileDrop&&(this._dnd=this._setupDragAndDrop()),this._options.paste.targetElement&&this._options.paste.promptForName&&(t.PasteSupport?this._setupPastePrompt():this.log("Paste support module not found.","error")),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0)},t.extend(t.FineUploader.prototype,t.basePublicApi),t.extend(t.FineUploader.prototype,t.basePrivateApi),t.extend(t.FineUploader.prototype,t.uiPublicApi),t.extend(t.FineUploader.prototype,t.uiPrivateApi),t.Templating=function(e){"use strict";var n,i,o,r,a,s,u,l,c={content:document.createDocumentFragment(),map:{}},d=!1,p=0,h=!1,f=[],m=-1,g={log:null,limits:{maxThumbs:0,timeBetweenThumbs:750},templateIdOrEl:"qq-template",containerEl:null,fileContainerEl:null,button:null,imageGenerator:null,classes:{hide:"qq-hide",editable:"qq-editable"},placeholders:{waitUntilUpdate:!1,thumbnailNotAvailable:null,waitingForThumbnail:null},text:{paused:"Paused"}},_={button:"qq-upload-button-selector",alertDialog:"qq-alert-dialog-selector",dialogCancelButton:"qq-cancel-button-selector",confirmDialog:"qq-confirm-dialog-selector",dialogMessage:"qq-dialog-message-selector",dialogOkButton:"qq-ok-button-selector",promptDialog:"qq-prompt-dialog-selector",uploader:"qq-uploader-selector",drop:"qq-upload-drop-area-selector",list:"qq-upload-list-selector",progressBarContainer:"qq-progress-bar-container-selector",progressBar:"qq-progress-bar-selector",totalProgressBarContainer:"qq-total-progress-bar-container-selector",totalProgressBar:"qq-total-progress-bar-selector",file:"qq-upload-file-selector",spinner:"qq-upload-spinner-selector",size:"qq-upload-size-selector",cancel:"qq-upload-cancel-selector",pause:"qq-upload-pause-selector",continueButton:"qq-upload-continue-selector",deleteButton:"qq-upload-delete-selector",retry:"qq-upload-retry-selector",statusText:"qq-upload-status-text-selector",editFilenameInput:"qq-edit-filename-selector",editNameIcon:"qq-edit-filename-icon-selector",dropText:"qq-upload-drop-area-text-selector",dropProcessing:"qq-drop-processing-selector",dropProcessingSpinner:"qq-drop-processing-spinner-selector",thumbnail:"qq-thumbnail-selector"},v={},b=new t.Promise,y=new t.Promise,S=function(){var e=g.placeholders.thumbnailNotAvailable,t=g.placeholders.waitingForThumbnail,i={maxSize:m,scale:l};u&&(e?g.imageGenerator.generate(e,new Image,i).then(function(e){b.success(e)},function(){b.failure(),n("Problem loading 'not available' placeholder image at "+e,"error")}):b.failure(),t?g.imageGenerator.generate(t,new Image,i).then(function(e){y.success(e)},function(){y.failure(),n("Problem loading 'waiting for thumbnail' placeholder image at "+t,"error")}):y.failure())},w=function(e){var n=new t.Promise;return y.then(function(t){H(t,e),e.src?n.success():(e.src=t.src,e.onload=function(){e.onload=null,Q(e),n.success()})},function(){z(e),n.success()}),n},F=function(e,t,i){var o=L(e);return n("Generating new thumbnail for "+e),t.qqThumbnailId=e,g.imageGenerator.generate(t,o,i).then(function(){p++,Q(o),v[e].success()},function(){v[e].failure(),g.placeholders.waitUntilUpdate||M(e,o)})},x=function(){if(f.length){h=!0;var e=f.shift();e.update?X(e):V(e)}else h=!1},C=function(e){return O(T(e),_.cancel)},I=function(e){return O(T(e),_.continueButton)},E=function(e){return O(a,_[e+"Dialog"])},D=function(e){return O(T(e),_.deleteButton)},P=function(){return O(a,_.dropProcessing)},U=function(e){return O(T(e),_.editNameIcon)},T=function(e){return c.map[e]||t(s).getFirstByClass("qq-file-id-"+e)},R=function(e){return O(T(e),_.file)},k=function(e){return O(T(e),_.pause)},A=function(e){return null==e?O(a,_.totalProgressBarContainer)||O(a,_.totalProgressBar):O(T(e),_.progressBarContainer)||O(T(e),_.progressBar)},q=function(e){return O(T(e),_.retry)},B=function(e){return O(T(e),_.size)},N=function(e){return O(T(e),_.spinner)},O=function(e,n){return e&&t(e).getFirstByClass(n)},L=function(e){return u&&O(T(e),_.thumbnail)},z=function(e){e&&t(e).addClass(g.classes.hide)},H=function(e,n){var i=e.style.maxWidth,o=e.style.maxHeight;o&&i&&!n.style.maxWidth&&!n.style.maxHeight&&t(n).css({maxWidth:i,maxHeight:o})},M=function(e,n){var i=v[e]||(new t.Promise).failure(),o=new t.Promise;return b.then(function(e){i.then(function(){o.success()},function(){H(e,n),n.onload=function(){n.onload=null,o.success()},n.src=e.src,Q(n)})}),o},j=function(){var e,r,a,s,c,d,p,h,f,v,b;if(n("Parsing template"),null==g.templateIdOrEl)throw new Error("You MUST specify either a template element or ID!");if(t.isString(g.templateIdOrEl)){if(e=document.getElementById(g.templateIdOrEl),null===e)throw new Error(t.format("Cannot find template script at ID '{}'!",g.templateIdOrEl));r=e.innerHTML}else{if(void 0===g.templateIdOrEl.innerHTML)throw new Error("You have specified an invalid value for the template option!  It must be an ID or an Element.");r=g.templateIdOrEl.innerHTML}if(r=t.trimStr(r),s=document.createElement("div"),s.appendChild(t.toElement(r)),b=t(s).getFirstByClass(_.uploader),g.button&&(d=t(s).getFirstByClass(_.button),d&&t(d).remove()),t.DragAndDrop&&t.supportedFeatures.fileDrop||(f=t(s).getFirstByClass(_.dropProcessing),f&&t(f).remove()),p=t(s).getFirstByClass(_.drop),p&&!t.DragAndDrop&&(n("DnD module unavailable.","info"),t(p).remove()),t.supportedFeatures.fileDrop?t(b).hasAttribute("qq-drop-area-text")&&p&&(v=t(p).getFirstByClass(_.dropText),v&&t(v).remove()):(b.removeAttribute("qq-drop-area-text"),p&&t(p).hasAttribute("qq-hide-dropzone")&&t(p).css({display:"none"})),h=t(s).getFirstByClass(_.thumbnail),u?h&&(m=parseInt(h.getAttribute("qq-max-size")),m=m>0?m:null,l=t(h).hasAttribute("qq-server-scale")):h&&t(h).remove(),u=u&&h,i=t(s).getByClass(_.editFilenameInput).length>0,o=t(s).getByClass(_.retry).length>0,a=t(s).getFirstByClass(_.list),null==a)throw new Error("Could not find the file list container in the template!");return c=a.children[0].cloneNode(!0),a.innerHTML="",s.getElementsByTagName("DIALOG").length&&document.createElement("dialog"),n("Template parsing complete"),{template:s,fileTemplate:c}},G=function(e,n,i){var o=i,r=o.firstChild;n>0&&(r=t(o).children()[n].nextSibling),o.insertBefore(e,r)},V=function(e){var n=e.id,i=e.optFileOrBlob,o=i&&i.qqThumbnailId,r=L(n),a={customResizeFunction:e.customResizeFunction,maxSize:m,orient:!0,scale:!0};t.supportedFeatures.imagePreviews?r?g.limits.maxThumbs&&g.limits.maxThumbs<=p?(M(n,r),x()):w(r).done(function(){v[n]=new t.Promise,v[n].done(function(){setTimeout(x,g.limits.timeBetweenThumbs)}),null!=o?J(n,o):F(n,i,a)}):x():r&&(w(r),x())},X=function(e){var t=e.id,n=e.thumbnailUrl,i=e.showWaitingImg,o=L(t),r={customResizeFunction:e.customResizeFunction,scale:l,maxSize:m};if(o)if(n){if(!(g.limits.maxThumbs&&g.limits.maxThumbs<=p))return i&&w(o),g.imageGenerator.generate(n,o,r).then(function(){Q(o),p++,setTimeout(x,g.limits.timeBetweenThumbs)},function(){M(t,o),setTimeout(x,g.limits.timeBetweenThumbs)});M(t,o),x()}else M(t,o),x()},W=function(e,n){var i=A(e),o=null==e?_.totalProgressBar:_.progressBar;i&&!t(i).hasClass(o)&&(i=t(i).getFirstByClass(o)),i&&(t(i).css({width:n+"%"}),i.setAttribute("aria-valuenow",n))},Q=function(e){e&&t(e).removeClass(g.classes.hide)},J=function(e,i){var o=L(e),r=L(i);n(t.format("ID {} is the same file as ID {}.  Will use generated thumbnail from ID {} instead.",e,i,i)),v[i].then(function(){p++,v[e].success(),n(t.format("Now using previously generated thumbnail created for ID {} on ID {}.",i,e)),o.src=r.src,Q(o)},function(){v[e].failure(),g.placeholders.waitUntilUpdate||M(e,o)})};t.extend(g,e),n=g.log,t.supportedFeatures.imagePreviews||(g.limits.timeBetweenThumbs=0,g.limits.maxThumbs=0),a=g.containerEl,u=void 0!==g.imageGenerator,r=j(),S(),t.extend(this,{render:function(){n("Rendering template in DOM."),p=0,a.appendChild(r.template.cloneNode(!0)),z(P()),this.hideTotalProgress(),s=g.fileContainerEl||O(a,_.list),n("Template rendering complete")},renderFailure:function(e){var n=t.toElement(e);a.innerHTML="",a.appendChild(n)},reset:function(){a.innerHTML="",this.render()},clearFiles:function(){s.innerHTML=""},disableCancel:function(){d=!0},addFile:function(e,n,i,o,u){var l,p=r.fileTemplate.cloneNode(!0),h=O(p,_.file),f=O(a,_.uploader),m=u?c.content:s;u&&(c.map[e]=p),t(p).addClass("qq-file-id-"+e),f.removeAttribute("qq-drop-area-text"),h&&(t(h).setText(n),h.setAttribute("title",n)),p.setAttribute("qq-file-id",e),i?G(p,i.index,m):m.appendChild(p),o?(p.style.display="none",t(p).addClass("qq-hidden-forever")):(z(A(e)),z(B(e)),z(D(e)),z(q(e)),z(k(e)),z(I(e)),d&&this.hideCancel(e),l=L(e),l&&!l.src&&y.then(function(e){l.src=e.src,e.style.maxHeight&&e.style.maxWidth&&t(l).css({maxHeight:e.style.maxHeight,maxWidth:e.style.maxWidth}),Q(l)}))},addFileToCache:function(e,t,n,i){this.addFile(e,t,n,i,!0)},addCacheToDom:function(){s.appendChild(c.content),c.content=document.createDocumentFragment(),c.map={}},removeFile:function(e){t(T(e)).remove()},getFileId:function(e){var t=e;if(t){for(;null==t.getAttribute("qq-file-id");)t=t.parentNode;return parseInt(t.getAttribute("qq-file-id"))}},getFileList:function(){return s},markFilenameEditable:function(e){var n=R(e);n&&t(n).addClass(g.classes.editable)},updateFilename:function(e,n){var i=R(e);i&&(t(i).setText(n),i.setAttribute("title",n))},hideFilename:function(e){z(R(e))},showFilename:function(e){Q(R(e))},isFileName:function(e){return t(e).hasClass(_.file)},getButton:function(){return g.button||O(a,_.button)},hideDropProcessing:function(){z(P())},showDropProcessing:function(){Q(P())},getDropZone:function(){return O(a,_.drop)},isEditFilenamePossible:function(){return i},hideRetry:function(e){z(q(e))},isRetryPossible:function(){return o},showRetry:function(e){Q(q(e))},getFileContainer:function(e){return T(e)},showEditIcon:function(e){var n=U(e);n&&t(n).addClass(g.classes.editable)},isHiddenForever:function(e){return t(T(e)).hasClass("qq-hidden-forever")},hideEditIcon:function(e){var n=U(e);n&&t(n).removeClass(g.classes.editable)},isEditIcon:function(e){return t(e).hasClass(_.editNameIcon,!0)},getEditInput:function(e){return O(T(e),_.editFilenameInput)},isEditInput:function(e){return t(e).hasClass(_.editFilenameInput,!0)},updateProgress:function(e,t,n){var i,o=A(e);o&&n>0&&(i=Math.round(t/n*100),100===i?z(o):Q(o),W(e,i))},updateTotalProgress:function(e,t){this.updateProgress(null,e,t)},hideProgress:function(e){var t=A(e);t&&z(t)},hideTotalProgress:function(){this.hideProgress()},resetProgress:function(e){W(e,0),this.hideTotalProgress(e)},resetTotalProgress:function(){this.resetProgress()},showCancel:function(e){if(!d){var n=C(e);n&&t(n).removeClass(g.classes.hide)}},hideCancel:function(e){z(C(e))},isCancel:function(e){return t(e).hasClass(_.cancel,!0)},allowPause:function(e){Q(k(e)),z(I(e))},uploadPaused:function(e){this.setStatusText(e,g.text.paused),this.allowContinueButton(e),z(N(e))},hidePause:function(e){z(k(e))},isPause:function(e){return t(e).hasClass(_.pause,!0)},isContinueButton:function(e){return t(e).hasClass(_.continueButton,!0)},allowContinueButton:function(e){Q(I(e)),z(k(e))},uploadContinued:function(e){this.setStatusText(e,""),this.allowPause(e),Q(N(e))},showDeleteButton:function(e){Q(D(e))},hideDeleteButton:function(e){z(D(e))},isDeleteButton:function(e){return t(e).hasClass(_.deleteButton,!0)},isRetry:function(e){return t(e).hasClass(_.retry,!0)},updateSize:function(e,n){var i=B(e);i&&(Q(i),t(i).setText(n))},setStatusText:function(e,n){var i=O(T(e),_.statusText);i&&(null==n?t(i).clearText():t(i).setText(n))},hideSpinner:function(e){t(T(e)).removeClass("qq-in-progress"),z(N(e))},showSpinner:function(e){t(T(e)).addClass("qq-in-progress"),Q(N(e))},generatePreview:function(e,t,n){this.isHiddenForever(e)||(f.push({id:e,customResizeFunction:n,optFileOrBlob:t}),!h&&x())},updateThumbnail:function(e,t,n,i){this.isHiddenForever(e)||(f.push({customResizeFunction:i,update:!0,id:e,thumbnailUrl:t,showWaitingImg:n}),!h&&x())},hasDialog:function(e){return t.supportedFeatures.dialogElement&&!!E(e)},showDialog:function(e,n,i){var o=E(e),r=O(o,_.dialogMessage),a=o.getElementsByTagName("INPUT")[0],s=O(o,_.dialogCancelButton),u=O(o,_.dialogOkButton),l=new t.Promise,c=function(){s.removeEventListener("click",d),u&&u.removeEventListener("click",p),l.failure()},d=function(){s.removeEventListener("click",d),o.close()},p=function(){o.removeEventListener("close",c),u.removeEventListener("click",p),o.close(),l.success(a&&a.value)};return o.addEventListener("close",c),s.addEventListener("click",d),u&&u.addEventListener("click",p),a&&(a.value=i),r.textContent=n,o.showModal(),l}})},t.UiEventHandler=function(e,n){"use strict";function i(e){o.attach(e,r.eventType,function(e){e=e||window.event;var t=e.target||e.srcElement;r.onHandled(t,e)})}var o=new t.DisposeSupport,r={eventType:"click",attachTo:null,onHandled:function(e,t){}};t.extend(this,{addHandler:function(e){i(e)},dispose:function(){o.dispose()}}),t.extend(n,{getFileIdFromItem:function(e){return e.qqFileId},getDisposeSupport:function(){return o}}),t.extend(r,e),r.attachTo&&i(r.attachTo)},t.FileButtonsClickHandler=function(e){"use strict";function n(e,n){t.each(r,function(i,r){var a,s=i.charAt(0).toUpperCase()+i.slice(1);if(o.templating["is"+s](e))return a=o.templating.getFileId(e),t.preventDefault(n),o.log(t.format("Detected valid file button click event on file '{}', ID: {}.",o.onGetName(a),a)),r(a),!1})}var i={},o={templating:null,log:function(e,t){},onDeleteFile:function(e){},onCancel:function(e){},onRetry:function(e){},onPause:function(e){},onContinue:function(e){},onGetName:function(e){}},r={cancel:function(e){o.onCancel(e)},retry:function(e){o.onRetry(e)},deleteButton:function(e){o.onDeleteFile(e)},pause:function(e){o.onPause(e)},continueButton:function(e){o.onContinue(e)}};t.extend(o,e),o.eventType="click",o.onHandled=n,o.attachTo=o.templating.getFileList(),t.extend(this,new t.UiEventHandler(o,i))},t.FilenameClickHandler=function(e){"use strict";function n(e,n){if(o.templating.isFileName(e)||o.templating.isEditIcon(e)){var r=o.templating.getFileId(e);o.onGetUploadStatus(r)===t.status.SUBMITTED&&(o.log(t.format("Detected valid filename click event on file '{}', ID: {}.",o.onGetName(r),r)),t.preventDefault(n),i.handleFilenameEdit(r,e,!0))}}var i={},o={templating:null,log:function(e,t){},classes:{file:"qq-upload-file",editNameIcon:"qq-edit-filename-icon"},onGetUploadStatus:function(e){},onGetName:function(e){}};t.extend(o,e),o.eventType="click",o.onHandled=n,t.extend(this,new t.FilenameEditHandler(o,i))},t.FilenameInputFocusInHandler=function(e,n){"use strict";function i(e,i){if(o.templating.isEditInput(e)){var r=o.templating.getFileId(e);o.onGetUploadStatus(r)===t.status.SUBMITTED&&(o.log(t.format("Detected valid filename input focus event on file '{}', ID: {}.",o.onGetName(r),r)),n.handleFilenameEdit(r,e))}}var o={templating:null,onGetUploadStatus:function(e){},log:function(e,t){}};n||(n={}),o.eventType="focusin",o.onHandled=i,t.extend(o,e),t.extend(this,new t.FilenameEditHandler(o,n))},t.FilenameInputFocusHandler=function(e){"use strict";e.eventType="focus",e.attachTo=null,t.extend(this,new t.FilenameInputFocusInHandler(e,{}))},t.FilenameEditHandler=function(e,n){"use strict";function i(e){var t=u.onGetName(e),n=t.lastIndexOf(".");return n>0&&(t=t.substr(0,n)),t}function o(e){var n=u.onGetName(e);return t.getExtension(n)}function r(e,n){var i,r=e.value;void 0!==r&&t.trimStr(r).length>0&&(i=o(n),void 0!==i&&(r=r+"."+i),u.onSetName(n,r)),u.onEditingStatusChange(n,!1)}function a(e,t){n.getDisposeSupport().attach(e,"blur",function(){r(e,t)})}function s(e,t){n.getDisposeSupport().attach(e,"keyup",function(n){13===(n.keyCode||n.which)&&r(e,t)})}var u={templating:null,log:function(e,t){},onGetUploadStatus:function(e){},onGetName:function(e){},onSetName:function(e,t){},onEditingStatusChange:function(e,t){}};t.extend(u,e),u.attachTo=u.templating.getFileList(),t.extend(this,new t.UiEventHandler(u,n)),t.extend(n,{handleFilenameEdit:function(e,t,n){var o=u.templating.getEditInput(e);u.onEditingStatusChange(e,!0),o.value=i(e),n&&o.focus(),a(o,e),s(o,e)}})}}(window);
//# sourceMappingURL=jquery.fine-uploader.min.js.map